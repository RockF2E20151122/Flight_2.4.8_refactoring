define(["libs","c","cUI","CommonStore","FlightStore","FlightModel","cBasePageView",buildViewTemplatesPath("seatconfirm.html"),"cWidgetFactory"],function(a,b,c,d,e,f,g,h){var i,j=f.SeatSubmitModel.getInstance(),k=e.CheckPassengerStore.getInstance(),l=(e.CheckinParamStore.getInstance(),null);i=g.extend({tpl:h,backUrl:"selectseat",checkinListUrl:"checkin",events:{"click #js_return":"backAction","click .flight-header-action":"seatSubmitAction"},ready:function(){this.$el.html(this.tpl),this.elsBox={seat_info_box:this.$el.find("#seat_info_box"),seat_info_tpl:this.$el.find("#seat_info_tpl")},this.seat_info_fun=_.template(this.elsBox.seat_info_tpl.html())},onCreate:function(){this.showLoading(),this.ready()},onLoad:function(){this.showLoading(),l=this,m.genData(),this.renderSeatInfoBox(m),this.turning(),this.hideLoading()},backAction:function(){this.back(l.backUrl)},onShow:function(){this.setTitle("提交座位请求")},onHide:function(){this.elsBox.seat_info_box.empty(),this.hideLoading()},renderSeatInfoBox:function(a){this.elsBox.seat_info_box.html(this.seat_info_fun(a))},seatSubmitAction:function(){this.showLoading(),j.setParam("ver",0),j.setParam("oid",m.daCity.orderId),j.setParam("fno",m.flightCabin.flightNo);for(var a=[],c=0,d=m.seatInfo.length;d>c;c++){var e=m.seatInfo[c],f={};f.psgname=e.psgnam,e.setno?(f.srowno=parseInt(e.setno)+"",f.scolno=e.setno.replace(f.srowno,"")):0,a.push(f)}j.setParam("seatlst",a),j.excute(function(a){if(l.hideLoading(),1===a.rc){var c=new b.ui.Alert({title:"提示信息",message:"座位申请中<br/>稍后请登录值机查看预约选座结果",buttons:[{text:"确认",click:function(){l.back(l.checkinListUrl),this.hide()}}]});c.show()}else{var d=new b.ui.Alert({title:"提示信息",message:"座位申请失败",buttons:[{text:"返回",click:function(){l.back(l.checkinListUrl),this.hide()}},{text:"重试",click:function(){l.back(l.checkinListUrl),this.hide()}}]});d.show()}},function(){l.hideLoading();var a=new b.ui.Alert({title:"提示信息",message:"座位申请失败",buttons:[{text:"返回",click:function(){l.back(l.checkinListUrl),this.hide()}},{text:"重试",click:function(){l.showLoading(),l.seatSubmitAction(),this.hide()}}]});a.show()},!1,this)}});var m={daCity:{},flightCabin:{},seatInfo:[],genData:function(){var a=k.get();a&&(this.daCity.orderId=a.oid,this.daCity.dCityName=a.depname,this.daCity.aCityName=a.arrname,this.flightCabin.airc=a.airname,this.flightCabin.flightNo=a.fno,this.flightCabin.cabin=a.cfply,this.seatInfo=a.ciplst||[])}};return i});