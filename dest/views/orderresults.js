define(["cSales","libs","c","CommonStore","FlightStore","FlightModel","CPageModel","CPageStore",buildViewTemplatesPath("orderresults.html")],function(a,b,c,d,e,f,g,h,i){var j=e.FlightDetailsStore.getInstance(),k=e.FlightOrderDetailStore.getInstance(),l=e.FlightOrderListStore.getInstance(),m=e.FlightOrderParamStore.getInstance(),n=e.FlightSelectedInfo.getInstance(),o=(h.passengerQueryStore.getInstance(),h.passengerEditStore.getInstance(),e.FlightOrderInfoStore.getInstance()),p=(e.FlightPickTicketSelectStore.getInstance(),h.CustomerAddrStore.getInstance(),e.zqInAirportDateAndAddressStore.getInstance()),q=e.zqInCityDateAndAddressStore.getInstance(),r=e.OrderDetailReturnPage.getInstance(),s=(e.OrderCreateStore.getInstance(),d.UserStore.getInstance()),t=f.XiaoMiModel.getInstance(),u=e.FlightCCBStore.getInstance(),v=d.SalesObjectStore.getInstance(),w=e.FlightBookingResultStore.getInstance(),x=c.view.extend({pageid:"212002",tpl:i,hasAd:!0,onCreate:function(){r.remove(),k.remove(),l.remove()},onLoad:function(){this.showLoading(),k.remove(),r.remove(),l.remove(),this.render(),this.updatePage(function(){this.hideLoading()}),this.turning(),this.getSalesObj()},getSalesObj:function(){var b=this,c=b.getQuery("sales"),e=b.getQuery("sourceid"),f=d.SalesStore.getInstance().get();null!=f&&null==e&&null==c&&(e=f.sourceid),(c||e)&&a.getSalesObject(c||e,$.proxy(function(){a.replaceContent(b.$el)},this))},onShow:function(){this.setTitle("携程旅行网手机触屏版-订单完成"),r.remove(),$("#headerview").length>0&&$("#headerview").hide()},onHide:function(){userInfo=s?s.getUser():null,userInfo&&userInfo.IsNonUser&&s.remove(),r.remove(),l.remove(),this.hideLoading(),$("#headerview").length>0&&$("#headerview").show()},render:function(){n.remove();var a=o.getAttr("contact");o.remove(),o.setAttr("contact",a),j.remove(),p.remove(),q.remove(),r.remove(),k.remove(),this.$el.html(this.tpl),this.elsBox={infobox_tpl:this.$el.find("#infotpl"),infobox_box:this.$el.find("#infobox")},this.infoboxtplfun=_.template(this.elsBox.infobox_tpl.html())},updatePage:function(a){userInfo=s?s.getUser():null;var b=v.get();b&&b.sid&&(1575==+b.sid||1867==+b.sid)&&(this.$el.find("#js_home").hide(),this.$el.find("#footer").hide(),this.footer&&this.footer.hide(),this.hasAd=!1);var c=parseInt(this.getQuery("orderid")),d=this.getQuery("rc"),e=this.getQuery("ErrorCode");e&&e>0&&(d=e,this.getQuery("ErrorMessage")&&(f.errorMsg=this.getQuery("ErrorMessage")));var f=w.get()||{};if(f.rc=d,f.orderId=c,0==f.rc){var b=JSON.parse(window.localStorage.getItem("SALES")),g={};if(b&&b.data&&1575==+parseInt(b.data.sourceid)){var h=JSON.parse(window.localStorage.getItem("XIAOMI_TOKEN"));h&&(g.appk="5311722679795",g.clid="2882303761517226795",g.actk=h.access_token,g.mcky=h.mac_key,g.oridurl="http://"+window.location.host+"/webapp/fltintl/#fltintlorderdetail?oid=",g.orid=c,g.btype=101,t.setParam(g),t.excute(function(a){0},function(){},this.false))}}if(userInfo&&userInfo.Auth&&c){f.user=userInfo,f._sales=b,f.isCCB=u.getAttr("isCCB")?!0:!1;var i=f.amt;this.getQuery("price")&&this.getQuery("price")>0&&(i=parseInt(this.getQuery("price")),w.setAttr("amt",i)),f.price=i;var j=f.paytype;null!=this.getQuery("paytype")&&this.getQuery("paytype")>0&&(j=this.getQuery("paytype"),w.setAttr("paytype",j),f.paytype=j);for(var k={},l=0;l<f.orders.length;l++){var m=f.orders[l];if(m.master&&1==m.master){k=m;break}}if(null!=f.rebinf){var n=f.rebinf;if(f.ext=n.rebtcode,f.days=n.rebtday,n&&n.rebtday&&+n.rebtday>0&&!userInfo.IsNonUser){var o=window.navigator.userAgent,p="http://weixin.qq.com/m";o&&(o=o.toLowerCase(),(o.indexOf("iphone")>-1||o.indexOf("ios")>-1)&&(p="https://itunes.apple.com/cn/app/id414478124?mt=8&ls=1")),f.app=p}}var q=this.infoboxtplfun(f);this.elsBox.infobox_box.html(q)}else{var x=this;if(0==d)this.showHeadWarning("订单完成","您的订单已提交成功，请返回至我的携程进行订单查询",function(){x.backAction(),this.hide(),r.remove(),x.hideLoading()});else{var q=this.infoboxtplfun(f);this.elsBox.infobox_box.html(q)}}a.call(this)},events:{"click #js_return":"backAction","click #js_home":"backHome","click .flight-icon-wxfx":"rebateAction","click .orderid":"viewOrder","click #reg":"regAction"},backAction:function(){userInfo=s?s.getUser():null,userInfo&&userInfo.IsNonUser&&s.remove(),this.jump("/webapp/flight/",!0)},backHome:function(){userInfo=s?s.getUser():null,userInfo&&userInfo.IsNonUser&&s.remove();var a=v.get();a&&a.sid&&1896==+a.sid?window.location="map://leftClick()":u.getAttr("isCCB")?this.jump("/webapp/mkt/ccb/"):this.jump("/html5/",!0)},rebateAction:function(a){var b=($(a.currentTarget),w.get()||{}),d=b.rebinf,e=this;this.fxAlert=new c.ui.Alert({title:"返现提示",message:"1.在微信众查找“携程旅行网”加关注</br>2.在聊天输入框中输入验证码“"+d.rebtcode+"”后发送",buttons:[{text:"确定",click:function(){this.hide()}},{text:"去下载",click:function(){var a=window.navigator.userAgent;if(a){a=a.toLowerCase();var b="http://weixin.qq.com/m",c="https://itunes.apple.com/cn/app/id414478124?mt=8&ls=1";a.indexOf("android")>-1?(this.hide(),e.jump(b)):a.indexOf("iphone")>-1?(this.hide(),e.jump(c)):this.hide()}else this.hide()}}]}),this.fxAlert.show()},viewOrder:function(a){var b=$(a.currentTarget).attr("data-id");if(userInfo=s?s.getUser():null,b&&userInfo&&userInfo.Auth){this.showLoading();var c={Id:b,url:"/webapp/flight/index.html#orderresults?orderid="+b};m.set(c),this.jump("/webapp/flight/#flightorderdetail")}},regAction:function(a){window.location.href=$(a.currentTarget).attr("data-href")}});return x});