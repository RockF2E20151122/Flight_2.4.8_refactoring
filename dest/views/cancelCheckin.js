define(["libs","c","cBasePageView","CommonStore","FlightModel","FlightStore","Validate",buildViewTemplatesPath("cancelCheckin.html"),"cUtility","cWidgetFactory","cWidgetGuider"],function(a,b,c,d,e,f,g,h){var i=b.ui,j=(b.base,d.SalesObjectStore.getInstance,d.UserStore.getInstance()),k=(j?j.getUser():null,!1),l=!1,m="",n=c.extend({pageid:"",tpl:h,checkPassengerStore:f.CheckPassengerStore.getInstance(),flightCancelCheckStore:f.FlightCancelCheckStore.getInstance(),getAuthCodeModel:e.GetAuthCodeModel.getInstance(),checkInCancelSubmitModel:e.CheckInCancelSubmitModel.getInstance(),flightAirlineStore:f.FlightAirlineStore.getInstance(),flightAirlineModel:e.FlightAirlineModel.getInstance(),cancelCheckResultStore:f.CancelCheckResultStore.getInstance(),render:function(){this.$el.html(this.tpl),this.els={flight_cancel_tpl:this.$el.find("#flight_cancel_tpl"),flight_cancel_box:this.$el.find("#flight_cancel_box")},this.flight_cancel_fun=_.template(this.els.flight_cancel_tpl.html())},renderData:function(a){var b=this,c=b.flight_cancel_fun(a);b.els.flight_cancel_box.html(c)},passValidation:function(a){var b=$(a.srcElement||a.target),c=$.trim(b.val());c=c.replace(/\D/g,""),b.val(c)},getCheckCode:function(){if(1==k)return!1;var a=this,b=a.flightCancelCheckStore.get();if(b){k=!0;var c=b.oid,d=b.fcsinf,e=b.psginf;a.getAuthCodeModel.setParam("oid",c),a.getAuthCodeModel.setParam("fcsinf",d),a.getAuthCodeModel.setParam("psginf",e),a.showLoading(),a.getAuthCodeModel.excute(function(b){if(a.hideLoading(),$("#jsGetCode").addClass("yzm2"),$("#jsGetCode").html("重新获取<br><em >60秒</em>"),b)if(0==b.rc){a.showToast("验证码已发送",1);var c=60;m=setInterval(function(){0>=c?($("#jsGetCode").removeClass("yzm2"),$("#jsGetCode").html("获取<br/>验证码"),k=!1,clearInterval(m),m=""):$("#jsGetCode").html("重新获取<br><em >"+c+"秒</em>"),c--},1e3)}else a.showToast("获取验证码失败，请重试",1),$("#jsGetCode").removeClass("yzm2"),$("#jsGetCode").html("获取<br/>验证码"),k=!1},function(){a.hideLoading(),a.showToast("获取验证码失败，请重试",1),$("#jsGetCode").removeClass("yzm2"),$("#jsGetCode").html("获取<br/>验证码"),k=!1},!1,this)}else a.showToast("数据请求失败",1,function(){a.back()})},confirmCancel:function(){var a=this;if(l)return!1;$("#jsYzmLine").removeClass("highlight");var c=$.trim($("#jsCheckCode").val());if(0==c.length)return a.showToast("请输入验证码",2),$("#jsYzmLine").addClass("highlight"),!1;var d=a.flightCancelCheckStore.get();if(d){var e=d.psginf.psgname,f="确定取消"+e+"值机?";a.cancelAlert=new i.Alert({message:f,buttons:[{text:"关闭",click:function(){this.hide()},type:b.ui.Alert.STYLE_CANCEL||"cancel"},{text:"确定",click:function(){this.hide(),a.submitCancel()},type:b.ui.Alert.STYLE_CANCELSTYLE_CONFIRM}]}),a.cancelAlert.show()}else a.showToast("数据请求失败",1,function(){a.back()})},submitCancel:function(){var a=this,b=a.flightCancelCheckStore.get();if(b){l=!0;var c=b.oid,d=b.fcsinf,e=b.psginf,f=$.trim($("#jsCheckCode").val());a.checkInCancelSubmitModel.setParam("oid",c),a.checkInCancelSubmitModel.setParam("fcsinf",d),a.checkInCancelSubmitModel.setParam("psginf",e),a.checkInCancelSubmitModel.setParam("aucde",f),a.showLoading(),a.checkInCancelSubmitModel.excute(function(b){l=!1,a.hideLoading(),a.cancelCheckResultStore.set(b),a.back("CheckInList")},function(){l=!1,a.hideLoading(),a.showToast("数据请求失败",1)},!1,a)}else a.showToast("数据请求失败",1,function(){a.back()})},events:{"click #jsGetCode":"getCheckCode","click #jsBtnSubmit":"confirmCancel","click #js_return":"backAction"},onCreate:function(){this.render()},formatData:function(a){var b={};try{b={ahtyp:a.ahtyp,aucde:a.aucde,oid:a.oid,fcsinf:{aircde:a.aircde,fno:a.fno,dcode:a.dacode,acode:a.aacode,ddate:a.depdat,setno:a.ciplst[0].setno},psginf:{ctype:a.ciplst[0].ctype,cno:a.ciplst[0].cno,tno:a.ciplst[0].tno,psgname:a.ciplst[0].psgnam,phone:a.ciplst[0].phone}}}catch(c){return null}return b},onLoad:function(){var a=this;""!=m&&(clearInterval(m),m=""),$("#jsGetCode").removeClass("yzm2"),$("#jsGetCode").html("获取<br/>验证码"),k=!1,a.turning();var b=a.formatData(a.checkPassengerStore.get());if(0,a.flightCancelCheckStore.set(b),0,b)if(null==a.flightAirlineStore.get())a.showLoading(),a.flightAirlineModel.excute(function(c){if(a.hideLoading(),c){var d=a.flightAirlineStore.get(),e=d[b.fcsinf.aircde];b.airlineName=e.name}else b.airlineName="";a.renderData(b)},function(){a.hideLoading(),b.airlineName="",a.renderData(b)},!1,this);else{var c=a.flightAirlineStore.get(),d=c[b.fcsinf.aircde];b.airlineName=d.name,a.renderData(b)}else a.backAction()},onShow:function(){},onHide:function(){$("#jsCheckCode").val(""),this.hideLoading(),this.flightCancelCheckStore.remove(),this.checkPassengerStore.remove(),this.flightAirlineModel.abort(),this.getAuthCodeModel.abort(),this.checkInCancelSubmitModel.abort()},backAction:function(){this.back("CheckInList")}});return n});