define(["libs","c","CommonStore","FlightModel","FlightStore",buildViewTemplatesPath("cabinlist.html")],function(a,b,c,d,e,f){var g=(b.ui,b.base,c.SalesObjectStore.getInstance(),null),h=b.view.extend({pageid:"",hasAd:!0,tpl:f,flightSearchSubjoin:e.FlightSearchSubjoinStore.getInstance(),flightSearchStore:e.FlightSearchStore.getInstance(),flightList:d.FlightListModel.getInstance(),flightSelectedStore:e.FlightSelectedInfo.getInstance(),flightOrderStore:e.FlightOrderInfoStore.getInstance(),flightDetailsStore:e.FlightDetailsStore.getInstance(),cabinParamStore:e.FlightCabinParamStore.getInstance(),cabinModel:d.FlightCabinModel.getInstance(),flightSearchStore:e.FlightSearchStore.getInstance(),salesStore:c.SalesObjectStore.getInstance(),flightType:null,flightDetailsData:null,cabinItems:null,render:function(){this.viewdata.req=this.request,this.$el.html(this.tpl),this.els={cabinList:this.$el.find("#cabinList"),cabinListTpl:this.$el.find("#cabinListTpl")},this.cabinListTpl=_.template(this.els.cabinListTpl.html())},events:{"click #js_return":"backAction","click .flight-list-tablebox":"cabinItemSelectAction","click js_return":"returnAction","click .d2":"rmkAction"},onCreate:function(){this.render()},onLoad:function(){g=this,this.updatePage()},returnAction:function(){this.back("bookinginfo")},onShow:function(){this.setTitle("选择舱位")},onHide:function(){this.hideLoading()},cabinItemSelectAction:function(a){var b=this,c=this.flightSelectedStore.get();c||this.showHeadWarning("选择舱位","由于您长时间未提交订单，数据可能已经过时，请返回重新选择航班",function(){b.backAction(),this.hide(),b.hideLoading()});var d=$(a.currentTarget),e=$(a.target),f=d.attr("data-key");if(!(e.is(".d2")||e.is(".d2 p")||e.is(".d2 .clr-000"))){var g=this.cabinItems.cabins[f];switch(this.flightType){case 0:var h=c.depart;h.cabin.class=g.class,h.cabin.price=g.price,h.cabin.rebateAmt=g.rebateAmt,h.cabin.productType=g.productType,h.cabin.subClass=g.subclass,h.cabin.pid=g.polid,this.flightSelectedStore.setAttr("depart",h);break;case 1:var i=c.arrive;i.cabin.class=g.class,i.cabin.price=g.price,i.cabin.rebateAmt=g.rebateAmt,i.cabin.productType=g.productType,i.cabin.subClass=g.subclass,i.cabin.pid=g.polid,this.flightSelectedStore.setAttr("arrive",i)}this.backAction()}},backAction:function(){this.back("bookinginfo")},rmkAction:function(a){var b=$(a.currentTarget),c=b.closest("li").find(".flight-list-tabletips"),d=b.find("p");c.hasClass("js_hide")?(b.closest("ul").find(".flight-list-tabletips").not(".js_hide").prev().find(".d2 p").removeClass("flight-arrup"),b.closest("ul").find(".flight-list-tabletips").not(".js_hide").prev().find(".d2 p").addClass("flight-arrdown"),b.closest("ul").find(".flight-list-tabletips").not(".js_hide").addClass("js_hide"),d.removeClass("flight-arrdown"),d.addClass("flight-arrup"),c.removeClass("js_hide")):(d.removeClass("flight-arrup"),d.addClass("flight-arrdown"),c.addClass("js_hide"))},updatePage:function(){this.showLoading();var a=this;this.flightType=+this.cabinParamStore.getAttr("flightType"),this.flightDetailsData=this.flightDetailsStore.get();var b=this.flightSearchStore.get();if(isNaN(this.flightType)||!this.flightDetailsData||!this.flightDetailsData.items||!this.flightDetailsData.items.length||!b)return void this.showHeadWarning("选择舱位","由于您长时间未提交订单，数据可能已经过时，请返回重新选择航班",function(){a.backAction(),this.hide(),a.hideLoading()});var c=e.FlightDetailParamStore.getInstance().get(),d="";if(0==this.flightType){var f=this.flightDetailsData.items[this.flightType].basicInfo.polid.lastIndexOf("{");d=f>0?this.flightDetailsData.items[this.flightType].basicInfo.polid.substring(0,f-1):this.flightDetailsData.items[this.flightType].basicInfo.polid}else d=this.flightDetailsData.items[this.flightType].basicInfo.polid;d=JSON.parse(d),d.stype="L";var h=this.flightDetailsData.items[this.flightType].policy.class;this.cabinModel.setParam("polid",c.polid),this.cabinModel.setParam("prdid",JSON.stringify(d)),this.cabinModel.excute(function(a){a._viewBuildSeatTitlt=g._viewBuildSeatTitlt;var b=g.salesStore.get();a._sales=b,g.cabinItems=a,a.price=g.flightDetailsData.items[this.flightType].policy.price,a.grade=h,g.els.cabinList.html(g.cabinListTpl(a)),g.turning(),g.hideLoading()},function(){a.showHeadWarning("选择舱位","查询失败，请返回重新选择",function(){a.backAction(),this.hide(),a.hideLoading()})},!1,this)},renderList:function(a){a._viewBuildSeatTitlt=this._viewBuildSeatTitlt,this.cabinItems=a,this.els.cabinList.html(this.cabinListTpl(a)),this.turning(),this.hideLoading()},__assert:function(){var a=this.flightSearchStore.getSearchDetails(0,"dcityName"),b=this.flightSearchStore.getSearchDetails(0,"acityName");return a&&b?!0:(this.back("list"),!1)},_viewBuildSeatTitlt:function(a,b){var c,d=3==+b?"头等舱":2==+b?"公务舱":"经济舱";return 1==a?c='<i class="jGao">高端'+d+"</i>":2==a?c='<i class="jGao">超值'+d+"</i>":3==a?c='<i class="jGao">豪华'+d+"</i>":4==a?c="商务舱":5==a?c="头等舱":6==a?c="经济舱":7==a&&(c="<i >空中"+d+"</i>"),c||d}});return h});