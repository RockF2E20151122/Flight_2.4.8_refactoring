define(["libs","c","CommonStore","FlightStore","FlightModel","cBasePageView","utility/utility.js","cUtilityCrypt"],function(a,b,c,d,e,f,g){var h=c.UserStore.getInstance(),i=d.FlightBookingResultStore.getInstance(),j=e.PaymentThirdModel.getInstance(),k={getRequestData:function(a){var b=location.hash.replace(/^.*?\?/,"").replace(/\|.*$/,""),c=new g.QueryStringBuilder(b),d=c.get()||{};return k.getRequestData=function(a){return a?d[a]:d},a?d[a]:d},bookingCheck:function(a,b){a&&j.setParam(a),j.excute(function(a){var c=!1;b&&b(c,a)},function(a){b&&b(a)})}},l={requestError:function(a,b){var c=i.get()||{};b=b||{},c.errorMsg=b.resultmsg||b.msg||"支付失败,请稍后再试。",c.rc=!1,i.set(c);var d=k.getRequestData("orderID"),e="orderresults?rc=1&type=flight&orderid="+d;0,a.forward(e)},paySuccess:function(a,b){if(0==b.result){var c=k.getRequestData("backUrl");0,l.jumpToPay(a,b)}else l.requestError(a,b)},jumpToPay:function(a){var b=(i.get()||{},k.getRequestData()),c=b.backUrl;c=decodeURIComponent(c);var d=h.getUser().Auth,e=k.getRequestData("orderID"),f=location.origin+"/webapp/flight/#orderresults?rc=0&type=flight&orderid="+e,j=location.origin+"/webapp/flight/#orderresults?rc=2&type=flight&orderid="+e,l=new g.QueryStringBuilder;l.set("saveID",b.saveID),l.set("orderID",b.orderID),l.set("billNo",b.billNo),l.set("externalNo",b.externalNo),l.set("errorCode",b.errorCode),l.set("auth",d),l.set("tsBack",f),l.set("tpBack",j),c+="&"+l.toString(),0,a.jump(c)}},m=f.extend({pageid:"",onCreate:function(){},onLoad:function(){var a=this;a.showLoading();var b=k.getRequestData(),c={optype:1,orderinfo:{eno:b.externalNo,oid:b.orderID},btype:101,ver:0,payetype:b.payType};k.bookingCheck(c,function(b,c){var d=l.requestError,e=l.paySuccess;b?d(a,b):e(a,c),a.hideLoading()}),this.turning()},onShow:function(){},onHide:function(){this.hideLoading()}});return m});