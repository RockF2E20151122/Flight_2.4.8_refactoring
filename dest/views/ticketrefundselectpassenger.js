define(["cSales","libs","c","CommonStore","FlightStore","FlightModel","cBasePageView",buildViewTemplatesPath("ticketrefundselectpassenger.html"),"cUtility","cWidgetFactory","cWidgetGuider"],function(a,b,c,d,e,f,g,h,j){var k=d.SalesObjectStore.getInstance(),l=d.UserStore.getInstance(),m=e.FlightOrderParamStore.getInstance(),n=e.FlightOrderDetailStore.getInstance(),o=e.FlightTicketRefundChangeStore.getInstance(),p=e.FlightTicketRefundFormStore.getInstance(),q=f.FlightTicketRefundChangeModel.getInstance(),r=(f.FlightTicketRefundModel.getInstance(),c.ui,c.base),s=l.getUser(),t="选择退票登机人",u={viewData:{},num2Cnum:function(a){var b=a+"",c=b.split(""),d="",e=["","十","百","千","万"],f=["o","一","二","三","四","五","六","七","八","九"],g=c.length;for(i=1;g>=i;i++)d=0==~~c[g-i]?f[~~c[g-i]]+d:f[~~c[g-i]]+e[i-1]+d;return d=d.replace(/(.)\1+/,"$1"),d=d.replace(/o$/,""),"一十"==d&&(d="十"),d.replace("o","零")},getRefundChangeInfo:function(a){var b=m.get(),c=n.get();if(c&&b&&b.Id)q.setParam("flag",0),q.setParam("requestType",1),q.setParam("oid",b.Id),v.backUrl=b.url||v.backUrl,a.showLoading(),q.excute(function(b){if(a.hideLoading(),u.viewData=b,b&&b.head&&0==b.head.errcode)b.orderDetail=c,a.renderData(b);else{var d="数据加载失败";a.showToast(d)}},function(){a.hideLoading(),a.showWarning404(function(){location.reload()})},!0,this,function(){a.hideLoading(),a.showWarning404(function(){location.reload()})});else{var d=k.get();d&&d.sid&&1896==+d.sid?window.location="map://leftClick()":a.jump(a.homeUrl)}}},v=g.extend({pageid:"214394",tpl:h,hasAd:!0,homeUrl:"/html5",render:function(){this.$el.html(this.tpl),this.elsBox={ticketRefund_selectpassenger_tpl:this.$el.find("#ticketRefund_selectpassenger_tpl"),ticketRefund_selectpassenger_box:this.$el.find("#ticketRefund_selectpassenger_box")},this.ticketRefund_selectpassenger_creater=_.template(this.elsBox.ticketRefund_selectpassenger_tpl.html())},renderData:function(a){var b=this;a.cDate=r.Date;var c=b.ticketRefund_selectpassenger_creater(a);b.elsBox.ticketRefund_selectpassenger_box.html(c)},backAction:function(){if(s=l.getUser(),s&&s.Auth)this.back("ticketrefundmultiple");else{var a=k.get();a&&a.sid&&1896==+a.sid?window.location="map://leftClick()":this.jump(this.homeUrl)}},events:{"click #ticketRefund_selectpassenger_submit":"selectPassenger","click .js_checkbox":"checkboxAction"},onCreate:function(){if(!m.get()){var a=k.get();a&&a.sid&&1896==+a.sid?window.location="map://leftClick()":this.jump(this.homeUrl)}this.injectHeaderView(),this.render()},onShow:function(){this.setTitle(t)},onLoad:function(){var a=this;a.turning();var b=!0,c=k.get();c&&c.sid&&(1575==+c.sid||1867==+c.sid)&&(b=!1),a.headerview.set({title:t,back:!0,view:a,tel:{number:4000086666},home:b,events:{homeHandler:function(){var b=k.get();b&&b.sid&&1896==+b.sid?window.location="map://leftClick()":a.jump(a.homeUrl)},returnHandler:function(){a.backAction()}}}),a.headerview.show(),s=l.getUser();var d=o.get();if(d||a.showWarning404(function(){location.reload()}),s&&s.Auth&&d){var e=parseInt(a.request.query.segid);if(!e)return void a.back("ticketrefundmultiple");var f=u.num2Cnum(e),g=p.get()||{};g.segs=g.segs||[],g.segs[e-1]=g.segs[e-1]||{};var h={segId:e,cnId:f,passengerInfo:d.segs[e-1],selected:g.segs[e-1].psgs||[]};a.renderData(h)}else j.isInApp()?a.showWarning404(function(){location.reload()}):a.jump("/webapp/myctrip/#account/login?from="+encodeURIComponent(this.getRoot()+"#flightorderdetail"));this.getSalesObj()},getSalesObj:function(){var b=this,c=b.getQuery("sales"),e=b.getQuery("sourceid"),f=d.SalesStore.getInstance().get();null!=f&&null==e&&null==c&&(e=f.sourceid),(c||e)&&a.getSalesObject(c||e,$.proxy(function(){a.replaceContent(b.$el)},this))},onHide:function(){this.hideLoading(),this.hideWarning404()},selectPassenger:function(){var a=this,b=$("#ticketRefund_selectpassenger_box .js_passenger.checkbox_b_checked"),c=parseInt(a.request.query.segid)||0;if(c=Math.max(c-1,0),b.size()<=0)$("#ticketRefund_selectpassenger_box .js_passengerContainer").addClass("cui-input-error"),a.showToast("请至少选择一个登机人");else{var d=p.get()||{};d.segs=d.segs||[],d.segs[c]=d.segs[c]||{},d.segs[c].psgs=[],d.segs[c].segid=Math.max(c+1,0);var e=o.get();e||a.showWarning404(function(){location.reload()}),b.each(function(a,b){var f=$(b).attr("data-passengerIndex");d.segs[c].psgs[f]=e.segs[c].psgs[f]}),p.setAttr(d),a.back("ticketrefundmultiple")}},checkboxAction:function(a){var b=$(a.currentTarget);if(b.hasClass("flt_discheck"))return!1;var c=b.find("label"),d=c.hasClass("checkbox_wrap_b")?"checkbox_b_checked":"checkbox_bs_checked",e=c.hasClass(d)?"removeClass":"addClass";c[e](d)}});return v});