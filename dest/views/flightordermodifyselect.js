define(["libs","c","CommonStore","FlightStore","FlightModel","cBasePageView",buildViewTemplatesPath("flightordermodifyselect.html"),"cUtility","cHolidayCalendar","cWidgetFactory","cWidgetGuider","cWidgetCalendar"],function(a,b,c,d,e,f,g,h,j,k){var l=(b.ui,b.base),m=c.SalesObjectStore.getInstance(),n=(d.FlightOrderParamStore.getInstance(),c.UserStore.getInstance()),o=n.getUser(),p=d.FlightTicketRefundChangeStore.getInstance(),q=d.FlightTicketChangeForm.getInstance(),r=(k.create("Calendar"),f.extend({pageid:"214397",tpl:g,homeUrl:"/html5",calendar:null,passengerList:{},changeTime:{},formData:{},render:function(){this.$el.html(this.tpl),this.elsBox={flightordermodify_tpl:this.$el.find("#flightordermodifyselect_tpl"),flightordermodify_box:this.$el.find("#flightordermodifyselect_box")},this.flightordermodify_fun=_.template(this.elsBox.flightordermodify_tpl.html())},renderData:function(a){{var b=this;~~this.request.query.pindex}a.cDate=l.Date,a.num2Chnum=s;var c=b.flightordermodify_fun(a);b.elsBox.flightordermodify_box.html(c),b.autoSelectPassenger(a)},autoSelectPassenger:function(a){for(var b=0,c=0;c<a.psgs.length;c++)2==a.psgs[c].uiflag&&(b+=1);if(1==b){var d=this.$el.find("ul.list_psgs li.js_psgs").not(".flt_discheck");d.trigger("click")}},backAction:function(){if(o=n.getUser(),this.passengerList={},this.changeTime={},o&&o.Auth)this.back("flightordermodify");else{var a=m.get();a&&a.sid&&1896==+a.sid?window.location="map://leftClick()":this.jump(this.homeUrl)}},events:{"click .list_st_border #js_departDate":"departDateAction","click #flightordermodifyselect_submit":"flightordermodifyselectSubmit","click ul.list_psgs li.js_psgs":"selectPassengerList"},selectPassengerList:function(a){var b=$(a.currentTarget);b.hasClass("checkbox_b_checked")?b.removeClass("checkbox_b_checked"):b.addClass("checkbox_b_checked");var c;c=b.data("index");var d=~~this.request.query.pindex;this.changePassengerList(d,c,b.hasClass("checkbox_b_checked"))},changePassengerList:function(a,b,c){var d=p.get(),e=d.segs[a].psgs[b];c?(this.passengerList[a]=this.passengerList[a]||{},this.passengerList[a][b]={chgseg:{segid:d.segs[a].segid,psgname:e.name}}):delete this.passengerList[a][b]},flightordermodifyselectSubmit:function(){if(this.checkSumbitData()){var a=q.get(),b=~~this.request.query.pindex;a=a||{passengerList:{},changeTime:{}},a.passengerList=a.passengerList||{},a.passengerList[b]=a.passengerList[b]||{},a.passengerList[b]=this.passengerList[b],a.changeTime=a.changeTime||{},a.changeTime[b]=a.changeTime[b]||{},a.changeTime[b]=this.changeTime[b],q.setAttr(a),this.passengerList={},this.changeTime={},this.back("flightordermodify")}},checkSumbitData:function(){var a=this,b=!1,c=~~this.request.query.pindex,d=a.passengerList;a.$el.find("#js_departDate").removeClass("cui-input-error"),a.$el.find(".list_psgs li").removeClass("cui-input-error");for(var e in d[c])b=!0;if(b){if(a.changeTime[c])return!0;a.hideLoading(),a.$el.find("#js_departDate").addClass("cui-input-error");var f="请选择起飞日期";return a.showToast(f),!1}a.hideLoading(),a.$el.find(".list_psgs li").not(".flt_discheck").addClass("cui-input-error");var f="请至少选择一个登机人";return a.showToast(f),!1},onCreate:function(){this.injectHeaderView(),this.render()},onShow:function(){this.setTitle("改签信息填写")},onLoad:function(){var a=this,b=!0;a.headerview.set({title:"改签信息填写",back:!0,view:a,tel:{number:4000086666},home:b,events:{homeHandler:function(){var b=m.get();b&&b.sid&&1896==+b.sid?window.location="map://leftClick()":a.jump(a.homeUrl)},returnHandler:function(){a.backAction()}}}),a.headerview.show(),o=n.getUser(),o&&o.Auth?a.getFlightTicketRefundChangeSearch():h.isInApp()?a.showWarning404(function(){location.reload()}):a.jump("/webapp/myctrip/#account/login?from="+encodeURIComponent(this.getRoot()+"#flightorderdetail"))},onHide:function(){this.elsBox.flightordermodify_box.empty(),this.hideLoading(),this.hideWarning404()},checkData:function(a){try{if(a.tktinfo&&a.segs)return a.segs.length>0?!0:!1}catch(b){return!1}},getFlightTicketRefundChangeSearch:function(){var a=this;a.showLoading();var b=p.get(),c=~~this.request.query.pindex,d=q.get();d=d||{},a.hideLoading(),a.changeTime[c]&&a.changeTime[c].takedate||(this.changeTime=d.changeTime||{}),a.passengerList[c]||(this.passengerList=d.passengerList||{}),b&&b.segs[c]?(a.turning(),b.segs[c].selectp=d,this.createCalendar(new Date(b.tktinfo.expired.replace(/-/g,"/"))),a.renderData(b.segs[c])):(a.hideLoading(),a.showWarning404(function(){location.reload()}))},createCalendar:function(a){var b=this.getServerDate(),c=this,d=l.Date.diffMonth(b,a);d=d>0?d+1:1;var d=l.Date.diffMonth(b,a);d=d>0?d+1:1,0,this.calendar=new j({monthsNum:d,animatSwitch:"right",header:{title:"日期选择"},endTime:a,callback:function(){c.setPanelDate.apply(c,arguments),this._hide?this._hide():this.hide()},onShow:function(){$("#headerview header").css("z-index",99)},onHide:function(){c.$el.show(),$("#headerview header").css("z-index",9999)}})},departDateAction:function(){this.calendar.show()},setPanelDate:function(a){var b=this.elsBox.flightordermodify_box.find("#js_departDate .flt_rlink");b.addClass("flt_rshow"),b.html(l.Date.format(a,"Y-m-d"));var c=~~this.request.query.pindex;this.addDateTime(c,a)},addDateTime:function(a,b){this.changeTime[a]=this.changeTime[a]||{},this.changeTime[a].takedate=l.Date.format(b,"Y/m/d 0:00:00")}})),s=function(a){var b=a+"",c=b.split(""),d="",e=["","十","百","千","万"],f=["o","一","二","三","四","五","六","七","八","九"],g=c.length;for(i=1;g>=i;i++)d=0==~~c[g-i]?f[~~c[g-i]]+d:f[~~c[g-i]]+e[i-1]+d;return d=d.replace(/(.)\1+/,"$1"),d=d.replace(/o$/,""),"一十"==d&&(d="十"),d.replace("o","零")};return r});