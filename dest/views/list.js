define(["cSales","libs","c","CommonStore","FlightModel","FlightStore","flight/utility/utility","cMultipleDate","adLoad",buildViewTemplatesPath("list.html")],function(a,b,c,d,e,f,g,h,i,j){try{window["h5.flt.searchresult.speed"]=window["h5.flt.searchresult.speed"]||{},window["h5.flt.searchresult.speed"].begin=Date.now()}catch(k){}var l="h5.flt.searchresult",m=f.MdListStore.getInstance(),n=f.MdTransStore.getInstance();require(["cHolidayPriceCalendar"],function(){try{window["h5.flt.searchresult.speed"].loadCalendarEnd=Date.now()}catch(a){}});try{setTimeout(function(){var a=1==localStorage.getItem("__DEBUG__")?"flight/views/bookinginfo":"flight/dest/views/bookinginfo";require([a],function(){0},function(){0})},200)}catch(k){0}var o=(c.ui,c.base),p=d.SalesObjectStore.getInstance(),q={},r={},s=f.FlightCCBStore.getInstance(),t=new i,u=c.view.extend({pageid:"212004",hasAd:!1,tpl:j,flightSearchSubjoin:f.FlightSearchSubjoinStore.getInstance(),flightSearchStore:f.FlightSearchStore.getInstance(),flightFilterStore:f.FlightFilterStore.getInstance(),flightList:e.FlightListModel.getInstance(),flightCityListStore:f.FlightCityListStore.getInstance(),flightInterCityListStore:f.FlightInterCityListStore.getInstance(),lowestPrice:e.LowestPriceSearchModel.getInstance(),lowestPriceStore:f.LowestPriceSearchStore.getInstance(),flightSelectedStore:f.FlightSelectedInfo.getInstance(),flightOrderStore:f.FlightOrderInfoStore.getInstance(),flightDeliveryStore:f.FlightPickTicketSelectStore.getInstance(),flightListStore:f.FlightListStore.getInstance(),baseDataModel:null,basedata:null,cityType:null,sdatalist:"[]",IsDate:function(a){var b=/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/;return b.exec(a)?!0:!1},getAppUrl:function(){0;var a="";if(window.localStorage&&null!=window.localStorage.getItem("SALES")&&""!=window.localStorage.getItem("SALES")){var b=JSON.parse(window.localStorage.getItem("SALES"));null!=b.data&&(a=parseInt(b.data.sourceid))}var c=this.flightSearchStore.getSearchDetails(0,"date").replace(/\//g,""),d=this.flightSearchStore.getSearchDetails(0,"dCtyId"),e=this.flightSearchStore.getSearchDetails(0,"aCtyId"),f=this.flightSearchStore.getAttr("tabtype")||1,g="";if(1==f)g="/flight_inland_singlelist?c1="+f+"&c2="+d+"&c3="+e+"&c4="+c+"&extendSourceID="+a;else{var h=(this.flightSearchStore.getSearchDetails(1,"date")||"").replace(/\//g,"");g="/flight_inland_tolist?c1="+f+"&c2="+d+"&c3="+e+"&c4="+c+"&c5="+h+"&extendSourceID="+a}return g},getSdateList:function(){return JSON.parse(this.sdatalist)},renderPage:function(a,b,c,d,e){var f=this;if(null!=d){var g="",h="",i="",j="",k="",l="";if(d&&d.length>0)for(var m=0,n=d.length;n>m;m++)c&&""!=c&&(d[m].code.toLowerCase()==c.toLowerCase()||d[m].name==decodeURI(c)||d[m].id==c)&&(h=d[m].name,g=d[m].code,i=d[m].id,f.flightSearchStore.setAttr("amode","1")),b&&""!=b&&(d[m].code.toLowerCase()==b.toLowerCase()||d[m].name==decodeURI(b)||d[m].id==b)&&(k=d[m].name,j=d[m].code,l=d[m].id,f.flightSearchStore.setAttr("dmode","1"));(""==i||""==h)&&(g=f.flightSearchStore.getSearchDetails(0,"aCtyCode")||"SHA",i=f.flightSearchStore.getSearchDetails(0,"akey")||2,h=f.flightSearchStore.getSearchDetails(0,"acityName")||"上海"),(""==l||""==k)&&(j=f.flightSearchStore.getSearchDetails(0,"dCtyCode")||"BJS",l=f.flightSearchStore.getSearchDetails(0,"dkey")||2,k=f.flightSearchStore.getSearchDetails(0,"dcityName")||"北京"),a-2==0?(f.flightSearchStore.setSearchDetails(0,"dCtyCode",j),f.flightSearchStore.setSearchDetails(0,"dcityName",k),f.flightSearchStore.setSearchDetails(0,"dkey",l),f.flightSearchStore.setSearchDetails(0,"aCtyCode",g),f.flightSearchStore.setSearchDetails(0,"acityName",h),f.flightSearchStore.setSearchDetails(0,"akey",i),f.flightSearchStore.setSearchDetails(1,"aCtyCode",j),f.flightSearchStore.setSearchDetails(1,"acityName",k),f.flightSearchStore.setSearchDetails(1,"akey",l),f.flightSearchStore.setSearchDetails(1,"dCtyCode",g),f.flightSearchStore.setSearchDetails(1,"dcityName",h),f.flightSearchStore.setSearchDetails(1,"dkey",i)):(f.flightSearchStore.setSearchDetails(0,"dCtyCode",j),f.flightSearchStore.setSearchDetails(0,"dcityName",k),f.flightSearchStore.setSearchDetails(0,"dkey",l),f.flightSearchStore.setSearchDetails(0,"aCtyCode",g),f.flightSearchStore.setSearchDetails(0,"acityName",h),f.flightSearchStore.setSearchDetails(0,"akey",i),f.flightSearchStore.removeSearchDetails(1)),f.flightSearchStore.setAttr("ticketIssueCty",j),f.flightSearchStore.setCurSearchDetails([0]),f.updatePageDate(),f.reloadData(e)}},getSemParam:function(a){var b=this,c=this.getServerDate(),d=""!=b.getQuery("SearchType")&&null!=b.getQuery("SearchType")?b.getQuery("SearchType"):""!=b.getQuery("flighttype")&&null!=b.getQuery("flighttype")?b.getQuery("flighttype"):""!=b.getQuery("trip")&&null!=b.getQuery("trip")?b.getQuery("trip"):"";d=d.toLowerCase(),"d"==d?d=2:"s"==d&&(d=1);var e=b.flightSearchStore.getAttr("tabtype")||1;""!=d&&(b.flightSearchStore.setAttr("tabtype",d),b.flightSearchStore.setAttr("__tripType",d),b.flightSearchStore.setAttr("tripType",d),e=d);var f=""!=b.getQuery("dday")&&null!=b.getQuery("dday")?parseInt(b.getQuery("dday")):""!=b.getQuery("dayoffset")&&null!=b.getQuery("dayoffset")?parseInt(b.getQuery("dayoffset")):"";if(0==isNaN(f)&&f>0){var g=new o.Date(c).addDay(f).format("Y/m/d"),h=new o.Date(c).addDay(f+1).format("Y/m/d");e-2==0?(b.flightSearchStore.setSearchDetails(0,"date",g),b.flightSearchStore.setSearchDetails(1,"date",h),m.setAttr("DTime",g),m.setAttr("ATime",h)):(b.flightSearchStore.setSearchDetails(0,"date",g),m.setAttr("DTime",g))}var i=""!=b.getQuery("dcity")&&null!=b.getQuery("dcity")?b.getQuery("dcity"):""!=b.getQuery("_dcity")&&null!=b.getQuery("_dcity")?b.getQuery("_dcity"):""!=b.getQuery("departure")&&null!=b.getQuery("departure")?b.getQuery("departure"):"",j=""!=b.getQuery("acity")&&null!=b.getQuery("acity")?b.getQuery("acity"):""!=b.getQuery("_acity")&&null!=b.getQuery("_acity")?b.getQuery("_acity"):""!=b.getQuery("arrival")&&null!=b.getQuery("arrival")?b.getQuery("arrival"):"";if(""!=i&&""!=j){var k=null,l=null;if(null!=b.flightCityListStore.get())k=b.flightCityListStore.get(),l=b.flightInterCityListStore.get(),b.renderPage(e,i,j,k.cities,a);else{try{window["h5.flt.searchresult.speed"].loadBaseDataBegin=Date.now()}catch(n){}b.baseDataModel.excute(function(c,d,f){try{f&&(window["h5.flt.searchresult.speed"].loadBaseDataEnd=Date.now())}catch(g){}b.renderPage(e,i,j,c.flightCityList.cities,a)},function(){t.hide()},b,b)}}else b.updatePageDate(),this.reloadData(a)},datalist:[],isEmpty:!1,isRedirect:!1,getQueryStringByName:function(a){var b=location.search.match(new RegExp("[?&]"+a+"=([^&]+)","i"));return null==b||b.length<1?"":b[1]},render:function(){this.viewdata.req=this.request;try{window["h5.flt.searchresult.speed"].renderTplBegin=Date.now()}catch(a){}this.$el.html(this.tpl);try{window["h5.flt.searchresult.speed"].renderTplEnd=Date.now()}catch(a){}this.els={elf_list:this.$el.find(".f_list"),elflightlisttpl:this.$el.find("#flightlisttpl"),elt1:this.$el.find(".tab_time .t1"),elt2:this.$el.find(".tab_time .t2"),elt3:this.$el.find(".tab_time .t3"),elt4:this.$el.find(".tab_time .t4"),eltabby:this.$el.find(".tab_by li"),eltabtime:this.$el.find('li[data-type="time"]'),eltabfilter:this.$el.find('li[data-type="filter"]'),eltabprice:this.$el.find('li[data-type="price"]'),elflightTotal:this.$el.find("#flightTotal"),eltitle:this.$el.find("#title"),elemptylisttpl:this.$el.find("#emptylisttpl")},this.flightListTplFun=_.template(this.els.elflightlisttpl.html()),this.isShowData=!0},events:{"click #js_return":"backAction","click #js_home":"homeAction","click .tab_time li":"switchDate","click .js_subswitch":"switchsubListAction","click .js_flight_item":"tapFlightitemAction","click .js_flight_seat":"tapFlightSeatAction","click .tab_by li":"tapSortAction"},tapSortAction:function(a){var b,c=$(a.currentTarget),d=c.attr("data-type");switch(d){case"time":if(this.isEmpty)return;switch(m.addOpValue("SortWay","Time"),this.flightSearchSubjoin.setAttr("depart-sorttype","time"),b=this.flightSearchSubjoin.getAttr("depart-orderby")||"asc",c.hasClass("hover")||(b="asc"==b?"desc":"asc"),b){case"desc":this.flightSearchSubjoin.setAttr("depart-orderby","asc"),this.renderList();break;case"asc":this.flightSearchSubjoin.setAttr("depart-orderby","desc"),this.renderList()}break;case"filter":m.setAttr("IsFilter",!0),this.forward("flightlistfilter");break;case"price":if(this.isEmpty)return;if(m.addOpValue("SortWay","Price"),"price"!==this.flightSearchSubjoin.getAttr("depart-sorttype"))this.flightSearchSubjoin.setAttr("depart-sorttype","price"),this.renderList();else switch(b=this.flightSearchSubjoin.getAttr("depart-orderby")||"desc"){case"desc":this.flightSearchSubjoin.setAttr("depart-orderby","asc"),this.renderList();break;case"asc":this.flightSearchSubjoin.setAttr("depart-orderby","desc"),this.renderList()}}},sortHandler:{time_Asc:function(a,b){var c=o.Date.parse(a.dTime).valueOf(),d=o.Date.parse(b.dTime).valueOf();return c-d},time_Desc:function(a,b){var c=o.Date.parse(a.dTime).valueOf(),d=o.Date.parse(b.dTime).valueOf();return d-c},price_Asc:function(a,b){var c=a.cabins&&a.cabins[0]&&a.cabins[0].price||0,d=b.cabins&&b.cabins[0]&&b.cabins[0].price||0;return c-d},price_Desc:function(a,b){var c=a.cabins&&a.cabins[0]&&a.cabins[0].price||0,d=b.cabins&&b.cabins[0]&&b.cabins[0].price||0;return d-c}},homeAction:function(){var a=p.get();a&&a.sid&&1896==+a.sid?window.location="map://leftClick()":this.jump(s.getAttr("isCCB")?"/webapp/mkt/ccb/":"/html5/")},backAction:function(){m.setAttr("IsReturn",!0);try{this.mdSubmit()}catch(a){0}0,this.back("index")},tapFlightitemAction:function(a){var b=$(a.currentTarget),c=$(a.target);if(!c.is(".js_subswitch")){var d=b.attr("data-key"),e=b.attr("data-ckey"),f=this.datalist[d];if(f.cabins.length>e){var g=f.cabins[e];if(!g)return void this.showToast("对不起，由于您长时间未操作，请重新查询");this.flightSelectedStore.setAttr("depart",{flight:f,cabin:g}),this.toNextPage(f,g)}}},tapFlightSeatAction:function(a){var b=$(a.currentTarget),c=b.attr("data-key"),d=b.attr("data-parent-key"),e=this.datalist[d],f=e.cabins&&e.cabins[c];if(!f)return void this.showToast("对不起，由于您长时间未操作，请重新查询");try{var g=2==f.class?"C":3==f.class?"F":"Y";m.setAttr("SubClass",g),m.setAttr("FlightNoSequence",d);var h=b.parent().find("li").length;switch(!0){case 0===+c:m.setAttr("SubClassSequence",1);break;case+c===h-1:m.setAttr("SubClassSequence",-1);break;default:m.setAttr("SubClassSequence",0)}f.rebateAmt>0&&m.setAttr("ActiveType","PayBack")}catch(a){0}this.flightSelectedStore.setAttr("depart",{flight:e,cabin:f}),this.toNextPage(e,f)},toNextPage:function(a){var b=+(this.flightSearchStore.getAttr("tabtype")||1);switch(this.flightSelectedStore.removeAttr("arrive"),this.flightOrderStore.setAttr("selInsure","1"),b){case 1:this.isRedirect=!0,this.flightSearchStore.setAttr("fullCabin",!1);try{this.mdSubmit()}catch(c){0}this.forward("bookinginfo"),window.__isRequireBookininfoSucc||window.location.reload();break;case 2:{this.flightSearchStore.getSearchDetails(0,"date")+" "+(a.dTime||"").substr(10,8)}this.flightSearchStore.setAttr("tripType",2),this.flightSearchStore.setCurSearchDetails([0,1]);var d=this.flightSearchStore.getAttr("_items")[0].date,e=this.flightSearchStore.getAttr("_items")[1].date;new Date(d).getTime()>new Date(e).getTime()?this.flightSearchStore.setSearchDetails(1,"date",o.Date.format(new o.Date(d).addDay(1),"Y/m/d")):"";try{this.mdSubmit()}catch(c){0}0,this.forward("backlist")}},clearCurFilter:function(){this.flightSearchSubjoin.removeAttr("departfilter-type"),this.flightSearchSubjoin.removeAttr("departfilter-value"),this.flightFilterStore.removeAttr("departfilter-type"),this.flightFilterStore.removeAttr("departfilter-value")},resetSort:function(){this.flightSearchSubjoin.setAttr("depart-sorttype","time"),this.flightSearchSubjoin.setAttr("depart-orderby","asc")},switchsubListAction:function(a){var b=$(a.currentTarget),c=b.parent(),d=c.next(".js_sublist");try{m.addOpValue("MoreClassSequence",c.data("key"))}catch(a){0}"block"===d.css("display")?(d.hide(),b.removeClass("flight-packup").addClass("flight-packdown")):(d.show(),b.removeClass("flight-packdown").addClass("flight-packup"))},switchDate:function(a){var b=this;if("cheap-calendar"==$(a.currentTarget)[0].className||"today t2"==$(a.currentTarget)[0].className){if(!this.isShowData)return;this.isShowData=!1,q.prices&&q.prices.length>0&&require(["cHolidayPriceCalendar"],function(a){for(var d=a.serverDate,e=(d.getFullYear(),d.getMonth(),d.getDate(),[]),f=0,g=q.prices.length;g>f;f++)e[f]={date:q.prices[f].dDate,price:q.prices[f].price};var h=b.flightSearchStore.getSearchDetails(0,"dcityName"),i=b.flightSearchStore.getSearchDetails(0,"acityName"),j=new a({header:{title:'<span class="jPriceTitle">低价日历</span><span class="jPriceCity">'+h+"-"+i+"</span>",tel:"4000086666",home:!0,homeHandler:function(){var a=p.get();a&&a.sid&&1896==+a.sid?window.location="map://leftClick()":b.jump("/html5/",!0)}},monthsNum:12,voidInvalid:!1,format:"Y-m-d",priceDate:e,onShow:function(){this.findMinPrice(),$(".cui_cldweek").css("top","43px"),b.isShowData=!1,setTimeout(function(){b.__hide()},500),this.$el.find(".cui_cld_daycrt").removeClass("cui_cld_daycrt");try{var a=b.flightSearchStore.getAttr("_items")[0].date,c=o.Date.format(a,"Y-m-d"),d=this.$el.find('[data-date="'+c+'"]');d.addClass("cui_cld_daycrt");try{var e,f;"BackCompat"==document.compatMode?(e=document.body.clientHeight,f=document.body.scrollHeight):(e=document.documentElement.clientHeight,f=document.documentElement.scrollHeight),window.scrollTo(0,parseInt(d.offset().top-e/2))}catch(g){}flagHightLight=0}catch(h){}this.$el[0].offsetHeight},onHide:function(){b.__show(),$("body").data("cui-date",""),this.remove(),b.isShowData=!0},callback:function(a,d,e){this.hide();var f=c.utility.Date.format(a,"Y/m/d");this.$el.find(".cui_cld_daycrt").removeClass("cui_cld_daycrt"),e.addClass("cui_cld_daycrt"),b.lowestPriceClick(f)}});m.setAttr("DateQuery","PriceCalendar"),j.show(),b.GoToView="calendar"})}var d=$(a.currentTarget),e=d.attr("data-date"),f=this.flightSearchStore.getAttr("calendarendtime");f=o.Date.parse(f,!0);try{var g=d.hasClass("yesterday")?"BeforeDay":d.hasClass("tomorrow")?"AfterDay":"";m.setAttr("DateQuery",g)}catch(a){0}if(e&&(e=o.Date.parse(e,!0))<=f){this.flightSearchStore.setSearchDetails(0,"date",o.Date.format(e,"Y/m/d"));try{m.setAttr("DTime",o.Date.format(e,"Y/m/d")),this.mdSubmit()}catch(a){0}this.flightSearchStore.setCurSearchDetails([0]),this.updateTopDatePanel(e),t.show(),this.reloadData(function(){t.hide()})}},lowestPriceClick:function(a){var b=a,c=this.flightSearchStore.getAttr("calendarendtime");if(c=o.Date.parse(c,!0),b&&(b=o.Date.parse(b,!0))<=c){this.flightSearchStore.setSearchDetails(0,"date",o.Date.format(b,"Y/m/d"));try{m.setAttr("DTime",o.Date.format(b,"Y/m/d")),this.mdSubmit()}catch(d){0}this.flightSearchStore.setCurSearchDetails([0]),this.updateTopDatePanel(b),t.show(),this.reloadData(function(){t.hide()})}},buildEvent:function(){},disposeData:function(a){var b=a,c=this.flightSearchSubjoin.getAttr("departfilter-type"),d=this.flightSearchSubjoin.getAttr("departfilter-value"),e=/^\d{4}[-\/]\d{1,2}[-\/]\d{1,2}\s+(\d{1,2}:\d{1,2}):\d{1,2}$/i;switch(!0){case"0"===c&&!!d:b=_.filter(b,function(a){var b=e.exec(a.dTime);b=b&&b[1];var c=parseInt(b.replace(":","")),f=d.split("-"),g=parseInt(f[0].replace(":","")),h=parseInt(f[1].replace(":",""));return c>=g&&h>=c});break;case"1"===c&&!!d:b||(b=[]),b=_.filter(b,function(a){return a.cabins=_.filter(a.cabins,function(a){return 3==d?5===a.classForDisp||3==a["class"]||4===a.classForDisp||2==a["class"]:0==d?6===a.classForDisp||2!=a["class"]&&3!=a["class"]:!1}),a.cabins&&a.cabins.length>0});break;case"2"===c&&!!d:b=_.filter(b,function(a){return d===a.airlineCode})}var f=this.flightSearchSubjoin.getAttr("depart-sorttype"),g=this.flightSearchSubjoin.getAttr("depart-orderby");switch(0,this.els.eltabby.removeClass("hover"),!0){case"time"===f&&"asc"===g:b.sort(this.sortHandler.time_Asc),this.els.eltabtime.addClass("hover"),this.els.eltabtime.find("em").removeClass("flight-icon-pxd"),this.els.eltabtime.find("em").addClass("flight-icon-pxu");break;case"time"===f&&"desc"===g:b.sort(this.sortHandler.time_Desc),this.els.eltabtime.addClass("hover"),this.els.eltabtime.find("em").removeClass("flight-icon-pxu"),this.els.eltabtime.find("em").addClass("flight-icon-pxd");break;case"price"===f&&"asc"===g:b.sort(this.sortHandler.price_Asc),this.els.eltabprice.addClass("hover"),this.els.eltabprice.find("em").removeClass("flight-icon-pxd"),this.els.eltabprice.find("em").addClass("flight-icon-pxu");break;case"price"===f&&"desc"===g:b.sort(this.sortHandler.price_Desc),this.els.eltabprice.addClass("hover"),this.els.eltabprice.find("em").removeClass("flight-icon-pxu"),this.els.eltabprice.find("em").addClass("flight-icon-pxd")}return b},renderList:function(){function a(a,b,c,d,e){if("nds"==b){var f=$.grep(a,function(a){return 10==a.discount?null==d?5==c?5===a.classForDisp||3==a["class"]:6==c?6===a.classForDisp||2!=a["class"]&&3!=a["class"]:4==c?4===a.classForDisp||2==a["class"]:a.classForDisp===c:a.classForDisp+""+a["class"]==c+""+d:!1});if(f&&f.length>0)return f[0]}if("min"==b){for(var g=0;g<a.length;g++)for(var h=g;h<a.length;h++)if(a[g].price-a[h].price>0){var i=a[g];a[g]=a[h],a[h]=i}var f=$.grep(a,function(a){return null==d?6==c?6===a.classForDisp||2!=a["class"]&&3!=a["class"]:5==c?5===a.classForDisp||3==a["class"]:4==c?4===a.classForDisp||2==a["class"]:a.classForDisp===c:a.classForDisp+""+a["class"]==c+""+d});if(f&&f.length>0)return e?f.length-e>0?f[e]:null:f[0]}return null}function b(a,b){for(var c=0;c<a.length;c++)if(a[c]["class"]==b["class"]&&a[c].classForDisp==b.classForDisp&&a[c].price==b.price)return!0;return!1}var d=this.flightSearchStore.getSearchDetails(0,"date"),e=this.flightSearchStore.getSearchDetails(1,"date"),f=this.flightSearchStore.getSearchDetails(0,"dcityName"),g=this.flightSearchStore.getSearchDetails(0,"acityName"),h=this.flightSearchStore.getAttr("tabtype")||1;try{m.setAttr("DCity",f),m.setAttr("ACity",g),m.setAttr("FlightType",1===h?"OW":"RT"),m.setAttr("DTime",d),m.setAttr("ATime",e?e:"")}catch(i){0}this.datalist=this.disposeData(this.getSdateList());for(var j=this.flightSearchSubjoin.getAttr("departfilter-type-cabin"),k=p.get(),l=0;l<this.datalist.length;l++){var n=new Array,o=this.datalist[l].cabins,q=a(o,"min",6),r=a(o,"min",6,null,1),s=a(o,"nds",6),t=a(o,"min",4),u=a(o,"nds",4),v=a(o,"min",2,3),w=a(o,"min",5),x=a(o,"nds",5),y=a(o,"min",3,3);null==q||b(n,q)||n.push(q),null==r||b(n,r)||n.push(r),null==s||b(n,s)||n.push(s),null==t||b(n,t)||n.push(t),null==u||b(n,u)||n.push(u),null==v||b(n,v)||n.push(v),null==w||b(n,w)||n.push(w),null==x||b(n,x)||n.push(x),null==y||b(n,y)||n.push(y),this.datalist[l].cabins=n.length>0?n:o}var z={list:this.datalist,cDate:c.base.Date,bd:this.basedata,filterClass:j,_sales:k,_viewBuildSeatTitlt:this._viewBuildSeatTitlt,_viewfilterfirst:this._viewfilterfirst},A=this.flightListTplFun(z);try{window["h5.flt.searchresult.speed"].renderListBegin=Date.now()}catch(i){}this.els.elf_list.html(A);try{window["h5.flt.searchresult.speed"].renderListEnd=Date.now()}catch(i){}for(var B=0,l=0;l<this.datalist.length;l++)null!=this.datalist[l].flightNo&&B++;this.els.elflightTotal.html(B)},afterReFilter:function(){},updatePageDate:function(){var a=this.flightSearchStore.getSearchDetails(0,"date"),b=this.flightSearchStore.getSearchDetails(1,"date"),c=this.flightSearchStore.getSearchDetails(0,"dcityName"),d=this.flightSearchStore.getSearchDetails(0,"acityName"),e=this.flightSearchStore.getAttr("tabtype")||1,f=this.flightSearchSubjoin.getAttr("depart-sorttype"),g=this.flightSearchSubjoin.getAttr("depart-orderby"),h=o.Date.parse(a,!0),i=o.Date.parse(b,!0);switch(e&&(e=+e),e){case 1:this.els.eltitle.html(c+"-"+d);break;case 2:h>i&&(h=new Date(i.valueOf()),this.flightSearchStore.setSearchDetails(0,"date",o.Date.format(h,"Y/m/d H:i:s"))),this.els.eltitle.html("去程: "+c+"-"+d)}switch(!0){case"time"===f&&"asc"===g:this.els.eltabtime.addClass("hover"),this.els.eltabtime.find("em").html("↑");break;case"time"===f&&"desc"===g:this.els.eltabtime.addClass("hover"),this.els.eltabtime.find("em").html("↓");break;case"price"===f&&"asc"===g:this.els.eltabprice.addClass("hover"),this.els.eltabprice.find("em").html("↑");break;case"price"===f&&"desc"===g:this.els.eltabprice.addClass("hover"),this.els.eltabprice.find("em").html("↓")}},updateTopDatePanel:function(a){a.setHours(0,0,0,0);var b=new o.Date(a).addDay(-1),c=new o.Date(a),d=new o.Date(a).addDay(1),e=new o.Date(this.getServerDate()).setHours(0,0,0,0).valueOf(),f=this.flightSearchStore.getAttr("calendarendtime");f=o.Date.parse(f,!0),b.valueOf()>=e?(this.$el.find(".yesterday").removeClass("flight-listdate-disable"),this.els.elt1.attr("data-date",b.format("Y/m/d")),this.$el.find(".t1 .price").html(r[b.format("Y/m/d")]?"<dfn>&yen;</dfn>"+r[b.format("Y/m/d")]:" ")):(this.$el.find(".yesterday").addClass("flight-listdate-disable"),this.$el.find(".t1 .price").html(""),this.els.elt1.attr("data-date","")),c.valueOf()>=e?(this.$el.find("#js_CurDate").text(c.format("Y-m-d w")),this.els.elt2.attr("data-date",c.format("Y/m/d")),this.$el.find(".t2 .price").html(r[c.format("Y/m/d")]?"<dfn>&yen;</dfn>"+r[c.format("Y/m/d")]:"")):(this.els.elt2.html("--"),this.els.elt2.attr("data-date","")),d.valueOf()<=f?(this.$el.find(".tomorrow").removeClass("flight-listdate-disable"),this.els.elt3.attr("data-date",d.format("Y/m/d")),this.$el.find(".t3 .price").html(r[d.format("Y/m/d")]?"<dfn>&yen;</dfn>"+r[d.format("Y/m/d")]:"")):(this.$el.find(".tomorrow").addClass("flight-listdate-disable"),this.els.elt3.attr("data-date",""),this.$el.find(".t3 .price").html(""))},reloadData:function(a){var b=this;this.els.elf_list.empty(),this.flightSearchStore.setCurSearchDetails([0]);try{window["h5.flt.searchresult.speed"].loadFlightListBegin=Date.now()}catch(c){}this.els.elflightTotal.html(0),this.flightList.excute(function(b,c,d){try{d&&(window["h5.flt.searchresult.speed"].loadFlightListEnd=Date.now())}catch(e){}if(b.count||b.items&&b.items.length){this.sdatalist=JSON.stringify(b.items||[]),this.datalist=(b.items||[]).sort(this.sortHandler.price_Asc);for(var f=1/0,g=0,h=b.items.length;h>g;g++)b.items[g].cabins.length>0&&(f=+b.items[g].cabins[0].price<f?b.items[g].cabins[0].price:f);this.$el.find(".t2 .price").html("<dfn>&yen;</dfn>"+f),this.isEmpty=this.datalist.length?!1:!0,this.renderList(this.datalist||[])}else this.els.elf_list.html(this.els.elemptylisttpl.html()),this.isEmpty=!0;a.call(this,b)},function(c){t.hide(),c&&c.msg?setTimeout(function(){b.showToast(c.msg,0,function(){b.back("index")})},1e3):setTimeout(function(){b.showToast("数据加载失败",0,function(){b.back("index")})},1e3),a.call(this)},this.flightSearchStore.getAttr("fullCabin"),this)},updatePage:function(a){var b=this.getQuery("sourceid");if(b&&+b>0){for(var c=0,d=["497","1107","1108","3516","3512","3511","3503","3513","1595","1596","3524","3517","3518","1591","1825","1826","1827","1828","1829","1830","1831"],e=0,f=d.length;f>e;e++){var g=d[e];if(g==b){c=1;break}}c&&this.footer.checkForceDownload(b)}t.show(),this.getSemParam(a)},lowestPriceList:function(){var a=this;q.head={auth:null,errcode:0};var b=new Array,c={};try{window["h5.flt.searchresult.speed"].loadLowestPriceBegin=Date.now()}catch(d){}if(this.$el.find(".t2 .price").html(""),this.lowestPrice.excute(function(a,b,d){c=a;try{d&&(window["h5.flt.searchresult.speed"].loadLowestPriceEnd=Date.now())}catch(e){}},function(){},!1,this),c&&c.prices&&c.prices.length>0){for(var e=0,f=c.prices.length;f>e;e++)c.prices[e].dDate=new Date(c.prices[e].dDate.replace(/-/g,"/")),lowestDayKey=o.Date.format(c.prices[e].dDate,"Y/m/d"),r[lowestDayKey]=c.prices[e].price;b=c.prices,q.prices=b}else{c.prices=[];for(var g=this.getServerDate(),e=0,f=90;f>e;e++)c.prices.push({dDate:o.Date.parse(o.Date.format(g,"Ymd")).addDay(e).date,price:""}),lowestDayKey=o.Date.format(c.prices[e].dDate,"Y/m/d"),r[lowestDayKey]=c.prices[e].price;b=c.prices,q.prices=b}var h=a.flightSearchStore.getSearchDetails(0,"date"),i=o.Date.parse(h,!0);i=o.Date.format(i,"Y/m/d H:i:s"),i=new Date(i),a.updateTopDatePanel(i)},onCreate:function(){0,this.render(),this.buildEvent(),this.baseDataModel=new h({models:{flightCityList:e.FlightCityListModel.getInstance(),flightInterCityList:e.FlightInterCityListModel.getInstance()}}),this.$el.css({background:"#fff"})},getSalesObj:function(){var b=this,c=b.getQuery("sales"),e=b.getQuery("sourceid"),f=d.SalesStore.getInstance().get();null!=f&&null==e&&null==c&&(e=f.sourceid),(c||e)&&a.getSalesObject(c||e,$.proxy(function(){a.replaceContent(b.$el)},this))},onLoad:function(a){var b=this;b.turning();try{window["h5.flt.searchresult.speed"].viewOnloadBegin=Date.now()}catch(c){}var d=this.flightSearchStore.getAttr("items")[0];if(this.lowestPriceStore.setAttr("aCty",d.aCtyCode),this.lowestPriceStore.setAttr("dCty",d.dCtyCode),this.lowestPriceList(),this.__assert()){this.refer=a||"","bookinginfo"===this.refer&&this.isRedirect&&this.flightListStore.get()&&!this.flightSearchStore.getAttr("fullCabin")?this.turning():(this.isRedirect=!1,this.flightSearchStore.setAttr("__tripType",1),this.updatePage(function(){t.hide();try{window["h5.flt.searchresult.speed"].end=Date.now(),"undefined"==typeof window.__bfi&&(window.__bfi=[]);var a={renderListTime:window["h5.flt.searchresult.speed"].renderListEnd-window["h5.flt.searchresult.speed"].renderListBegin,renderTplTime:window["h5.flt.searchresult.speed"].renderTplEnd-window["h5.flt.searchresult.speed"].renderTplBegin,onloadTime:window["h5.flt.searchresult.speed"].end-window["h5.flt.searchresult.speed"].viewOnloadBegin};window["h5.flt.searchresult.speed"].loadCalendarTime&&(a.loadCalendarTime=window["h5.flt.searchresult.speed"].loadCalendarEnd-window["h5.flt.searchresult.speed"].begin),window["h5.flt.searchresult.speed"].loadFlightListEnd&&(a.listAPI=window["h5.flt.searchresult.speed"].loadFlightListEnd-window["h5.flt.searchresult.speed"].loadFlightListBegin),window["h5.flt.searchresult.speed"].loadLowestPriceEnd&&(a.priceAPI=window["h5.flt.searchresult.speed"].loadLowestPriceEnd-window["h5.flt.searchresult.speed"].loadLowestPriceBegin),window.__bfi.push(["_tracklog","h5.flt.searchresult.speed",JSON.stringify(a)])}catch(b){}}));var e=p.get(),f=this.getQuery("sourceid");(f&&(1575==+f||1867==+f)||e&&e.sid&&(1575==+e.sid||1867==+e.sid))&&(this.$el.find("#js_home").hide(),this.$el.find("#footer").hide(),this.footer&&this.footer.hide(),this.hasAd=!1),this.getSalesObj()}},onShow:function(){0,this.setTitle("机票列表页");var a=this.flightSearchStore.getSearchDetails(0,"date"),b=this.flightSearchStore.getSearchDetails(1,"date"),c=this.flightSearchStore.getSearchDetails(0,"dcityName"),d=this.flightSearchStore.getSearchDetails(0,"acityName"),e=this.flightSearchStore.getAttr("tabtype")||1;try{m.setAttr("DCity",c),m.setAttr("ACity",d),m.setAttr("FlightType",1===e?"OW":"RT"),m.setAttr("DTime",a),m.setAttr("ATime",b?b:"")}catch(f){0}"bookinginfo"===this.refer&&this.isRedirect&&this.restoreScrollPos()},onHide:function(a){0,("index"===a||""===a)&&(this.clearCurFilter(),this.resetSort());"bookinginfo"!=a&&"calendar"!=this.GoToView&&this.els.elf_list.empty(),t.hide()},_viewBuildSeatTitlt:function(a,b){var c,d=3==+b?"头等舱":2==+b?"公务舱":"经济舱";return c=1===a?'<i class="clr-ff9a14">高端'+d+"</i>":2===a?'<i class="clr-ff9a14">超值'+d+"</i>":3===a?'<i class="clr-ff9a14">豪华'+d+"</i>":4===a?"商务舱":5===a?"头等舱":6===a?"经济舱":7===a?'<i class="clr-ff9a14">空中'+d+"</i>":d},_viewfilterfirst:function(a){if(a&&a.length>0){for(var b=0,c=null,d=0;d<a.length;d++)0==d?(b=a[0].price,c=a[0],c.ckey=0):b-a[d].price>0&&(b=a[d].price,c=a[d],c.ckey=d);return c}},__assert:function(){return!0},mdSubmit:function(){var a=m.getAttr("FlightNoSequence"),b=m.getAttr("SubClassSequence"),c=m.getAttr("ActiveType");n.setAttr("dObj",{fns:a,scs:b,at:c}),g.sendUbt(l,m.get()),m.remove()}});return u});