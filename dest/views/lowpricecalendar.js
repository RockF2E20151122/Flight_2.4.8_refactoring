define(["cHolidayPriceCalendar","FlightModel","FlightStore","CommonStore","c"],function(a,b,c,d,e){var f=c.FlightSearchStore.getInstance(),g=(c.LowestPriceSearchStore.getInstance(),d.SalesObjectStore.getInstance()),h=e.base,i=b.LowestPriceSearchModel.getInstance(),j={},k={},l={CreateCalendar:function(b,c,d){j.head={auth:null,errcode:0};var l=new Array;i.setParam("back"==d?{aCty:f.getSearchDetails(0,"dCtyCode"),dCty:f.getSearchDetails(0,"aCtyCode")}:{aCty:f.getSearchDetails(0,"aCtyCode"),dCty:f.getSearchDetails(0,"dCtyCode")}),i.excute(function(i){i.prices=i.prices||[];for(var m=0,n=i.prices.length;n>m;m++)i.prices[m].dDate=new Date(i.prices[m].dDate.replace(/-/g,"/")),lowestDayKey=h.Date.format(i.prices[m].dDate,"Y/m/d"),k[lowestDayKey]=i.prices[m].price;l=i.prices,j.prices=l;for(var o=a.serverDate,p=(o.getFullYear(),o.getMonth(),o.getDate(),[]),m=0,q=365;q>m;m++)p[m]={date:j.prices[m]?j.prices[m].dDate:h.Date.parse(h.Date.format(o,"Ymd")).addDay(m).date,price:j.prices[m]?j.prices[m].price:""};var r,s;"back"==d?(r=f.getSearchDetails(0,"acityName"),s=f.getSearchDetails(0,"dcityName")):(r=f.getSearchDetails(0,"dcityName"),s=f.getSearchDetails(0,"acityName"));var t=f.getAttr("_items")[0].date,u=h.Date.format(t,"Y-m-d"),v=f.getAttr("_items").length>1?h.Date.format(f.getAttr("_items")[1].date,"Y-m-d"):null,w=h.Date.format(new h.Date(o).addDay(364),"Y-m-d"),x=new a({header:{title:'<span class="jPriceTitle">低价日历</span><span class="jPriceCity">'+r+"-"+s+"</span>",tel:"4000086666",home:!0,homeHandler:function(){var a=g.get();a&&a.sid&&1896==+a.sid?window.location="map://leftClick()":b.jump("/html5/",!0)}},monthsNum:13,format:"Y-m-d",priceDate:p,onShow:function(){this.findMinPrice(),b.hideLoading(),b.isShowData=!1,$(".cui_cldweek").css("top","43px"),setTimeout(function(){b.__hide()},500),this.$el.find(".cui_cld_daycrt").removeClass("cui_cld_daycrt");try{var a="start"==d?h.Date.format(o,"Y/m/d"):h.Date.format(t,"Y/m/d");this.$el.find(".cui_cld_daybox li").each(function(b,c){new Date($(c).data("date"))<new Date(a)&&($(this).removeClass(),$(this).addClass("cui_cld_daypass invalid"))}),"back"==d?(this.$el.find('[data-date="'+v+'"]').addClass("cui_cld_daycrt"),this.$el.find('[data-date="'+v+'"] em').text("返回")):(this.$el.find('[data-date="'+u+'"]').addClass("cui_cld_daycrt"),this.$el.find('[data-date="'+u+'"] em').text("出发")),flagHightLight=0}catch(c){}this.$el[0].offsetHeight},onHide:function(){b.hideLoading(),b.__show(),$("body").data("cui-date",""),this.remove(),b.isShowData=!0},callback:function(a,f,g){this.hide();var i=e.utility.Date.format(a,"Y/m/d");this.$el.find(".cui_cld_daycrt").removeClass("cui_cld_daycrt"),g.addClass("cui_cld_daycrt");var j="start"==d?{start:a}:{back:a};i==h.Date.format(w,"Y/m/d")?j.back=h.Date.parse(w).date:v&&i>h.Date.format(v,"Y/m/d")&&"start"==d&&(j.back=h.Date.parse(i).addDay(1).date,0),c.call(b,a,d,j)}});x.show()},function(a){a&&a.msg?setTimeout(function(){b.showToast(a.msg,0,function(){b.back("index")})},1e3):setTimeout(function(){b.showToast("数据加载失败",0,function(){b.back("index")})},1e3)},!1,this)}};return l});