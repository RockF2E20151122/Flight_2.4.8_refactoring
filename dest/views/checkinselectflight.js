define(["libs","c","cUI","CommonStore","FlightStore","FlightModel","cBasePageView",buildViewTemplatesPath("checkinselectflight.html"),"cWidgetFactory"],function(a,b,c,d,e,f,g,h){var i,j=e.CheckinParamStore.getInstance(),k=e.CheckPassengerStore.getInstance(),l=f.CheckinSegmentModel.getInstance(),m=e.CheckinSegmentStore.getInstance(),n=null;i=g.extend({tpl:h,backUrl:"checkinbooking",checkinSeatUrl:"selectseat",events:{"click .flight-zjxzxc":"forwardCheckinSeat","click #js_return":"backAction"},ready:function(){this.$el.html(this.tpl),this.elsBox={select_flight_box:this.$el.find("#select_flight_box"),select_flight_tpl:this.$el.find("#select_flight_tpl")},this.select_flight_fun=_.template(this.elsBox.select_flight_tpl.html())},onCreate:function(){this.showLoading(),this.ready()},onLoad:function(){this.showLoading(),n=this,this.renderSelectFlight(function(){n.turning(),n.hideLoading()})},backAction:function(){m.remove(),k.remove(),this.back(n.backUrl)},onShow:function(){this.setTitle("值机选择行程页")},onHide:function(){this.elsBox.select_flight_box.empty(),this.hideLoading()},renderSelectFlight:function(a){var b={};b.ver=0,b.alcode=j.getAttr("airCode"),b.ctype=j.getAttr("cardType"),b.cno=j.getAttr("card"),l.setParam(b),l.excute(function(){o.genFlightData(),n.elsBox.select_flight_box.html(n.select_flight_fun(o)),a&&a()},function(){a&&a()},!1,this)},forwardCheckinSeat:function(a){var b=j.get(),c=a.currentTarget.dataset.index;if(b){var d={backurl:"checkinselectflight",ciplst:[{cno:b.card,ctype:b.cardType,phone:b.tel}]},e=m.getAttr("fseglst")[c];if(!e||$.isEmptyObject(e))return void 0;d.aacode=e.acode,d.dacode=e.dcode,d.depdat=e.ddate,d.ciplst[0].psgnam=e.pname,d.fno=e.fno,d.arrname=e.aname,d.oid=0,d.depname=e.dname,d.airname=e.airname||"",k.set(d)}this.showLoading(),this.forward(this.checkinSeatUrl)}});var o={flightList:[],genFlightData:function(){this.flightList.length=0;var a=m.get();if(a&&a.fseglst)for(var b=0,c=a.fseglst.length;c>b;b++){var d=a.fseglst[b],e={};e.flightCompany=j.getAttr("airName"),e.flightDate=d.ddate?d.ddate.split(" ")[0]:"",e.flightNo=d.fno,e.dAir=d.dname,e.dTime=d.ddate&&d.ddate.split(" ")[1]?d.ddate.split(" ")[1].substring(0,5):"",e.dTer="",e.aAir=d.aname,e.aTime="--:--",e.aTer="",this.flightList.push(e)}}};return i});