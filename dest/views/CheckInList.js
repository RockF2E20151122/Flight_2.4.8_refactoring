define(["libs","c","CommonStore","FlightStore","FlightModel","cMultipleDate","cBasePageView",buildViewTemplatesPath("CheckInList.html"),"cUtility","cWidgetFactory","cWidgetGuider"],function(a,b,c,d,e,f,g,h){var i=null,j="/webapp/flight/index.html#index",k=e.CheckinSearchModel.getInstance(),l=e.CheckinListModel.getInstance(),m=d.CheckinSearchParamStore.getInstance(),n=d.CheckinListStore.getInstance(),o=e.CheckInCancelSubmitModel.getInstance(),p=d.CheckPassengerStore.getInstance(),q=d.CancelCheckResultStore.getInstance(),r=g.extend({tpl:h,render:function(){this.viewdata.req=this.request,this.$el.html(this.tpl),this.elsBox={list_wrap:this.$el.find("#list_wrap"),list_tpl:this.$el.find("#list_tpl")},this.elHTML=_.template(this.elsBox.list_tpl.html())},showView:function(){this.showLoading(),0===q.getAttr("rc")?(q.remove(),this.showMessage("已取消值机")):1===q.getAttr("rc")&&(q.remove(),this.showToast("取消失败")),l.excute(function(a){this.hideLoading(),this.hideWarning404(),a.fcinfos&&a.fcinfos.length>0?(a.cDate=b.base.Date,this.elsBox.list_wrap.html(this.elHTML(a)),this.turning()):this.showHeadWarning("值机","您还没有数据哦",function(){this.hide()})},function(a){this.hideLoading();var b=a.msg?a.msg:"啊哦,数据加载出错了!";this.showHeadWarning("值机",b,function(){this.hide()})},!0,this)},events:{"click .js_flight_tab li":"flightTapAction","click #js_return":"backAction","click span.js_checkin_btn":"checkInAction","click span.js_checkout_btn":"checkOutAction","click .js_unctripcheck_btn":"unCtripCheckAction"},onCreate:function(){i=this,this.render()},onLoad:function(){this.showView()},backAction:function(){var a=q.getAttr("backurl");a?this.jump(a):this.back("index")},onShow:function(){this.setTitle("值机"),this.hideLoading()},flightTapAction:function(a){var b=$(a.currentTarget),c=b.data("type");switch(c){case"index":this.jump(j);break;case"schedule":this.jump("/html5/Flight/Schedule/");break;case"checkin":}},checkInAction:function(a){var b=$(a.currentTarget),c=b.parents(".js_psg"),d=b.parents(".js_fcinfos"),e={alcode:d.data("aircde"),chkinfo:{acode:d.data("aacode"),dcode:d.data("dacode"),ddate:d.data("depdat")},oid:d.data("oid"),ver:0};m.set(e);var f=d.data("cinsta"),g=c.data("ctype"),h=c.data("tno");this.showLoading(),k.excute(function(a){if(a.cairinf&&1===+a.cairinf.rc){var b=a.cairinf.resmsg.split("|"),e="";if(b&&b.length>0&&(e=b[1]?b[0]+"<br/>"+b[1]:b[0]),2===+f){var i={oid:d.data("oid"),dacode:d.data("dacode")},j=n.getCurCheckInfo(i);p.set(j),this.forward("notimedcheckin")}else this.showMessage(e)}else{if(3===+g&&(!h||""===h)){if(2===+f){var i={oid:d.data("oid"),dacode:d.data("dacode")},j=n.getCurCheckInfo(i);p.set(j),this.forward("notimedcheckin")}else this.showMessage("您的证件不符合在线值机要求，请至机场柜台办理。");return void this.hideLoading()}var i={oid:d.data("oid"),dacode:d.data("dacode"),index:c.data("index"),psgnam:c.data("psgnam")},j=n.getCurCheckInfo(i);p.set(j),this.forward("checkinbooking")}this.hideLoading()},function(a){var b=a.msg?a.msg:"啊哦,数据加载出错了!";this.hideLoading(),this.showToast(b)},!0,this)},checkOutAction:function(a){var c=$(a.currentTarget),d=c.parents(".js_fcinfos"),e=c.parents(".js_psg");if(3===+d.data("ahtyp"))this.cancelAlert=new b.ui.Alert({title:"提示信息",message:"确定取消"+e.data("psgnam")+"值机？",buttons:[{text:"关闭",click:function(){this.hide()}},{text:"确定",click:function(){this.hide();var a={oid:d.data("oid"),dacode:d.data("dacode"),index:e.data("index"),psgnam:e.data("psgnam")},b=n.getCurCheckInfo(a);o.formatParam(b),o.excute(function(a){var b=a.rmsg;1===+a.rc?(b||(b="取消"+e.data("psgnam")+"值机失败"),i.showToast(b)):(b||(b="已取消"+e.data("psgnam")+"值机"),i.showToast(b),i.onLoad())},function(){i.showToast("请求失败，请重试")},!0,this)}}]}),this.cancelAlert.show();else{var f={oid:d.data("oid"),dacode:d.data("dacode"),index:e.data("index"),psgnam:e.data("psgnam")},g=n.getCurCheckInfo(f);p.set(g),this.forward("cancelCheckin")}},checkOutReq:function(){},unCtripCheckAction:function(){p.remove(),this.forward("checkinbooking")},onHide:function(){this.hideWarning404()}});return r});