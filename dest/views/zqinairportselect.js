define(["libs","c","FlightModel","FlightStore","CommonStore",buildViewTemplatesPath("zqinairportselect.html")],function(a,b,c,d,e,f){var g=(b.base,b.view.extend({flightSearchStore:d.FlightSearchStore.getInstance(),flightModel:c.FlightPickTicketModel.getInstance(),flightSelectedStore:d.FlightSelectedInfo.getInstance(),flightStore:d.zqInAirportSelectStore.getInstance(),FlightDetailsStore:d.FlightDetailsStore.getInstance(),airportDeliveryStore:d.zqInAirportDateAndAddressStore.getInstance(),userStore:e.UserStore.getInstance(),tpl:f,pageid:"214032",render:function(){this.$el.html(this.tpl),this.els={listBox:this.$el.find("#cbox2"),listTpl:this.$el.find("#address-list2")},this.temFun=_.template(this.els.listTpl.html())},events:{"click .light":"selectAddr","click #js_return":"goBack"},goBack:function(){this.forward("bookinginfo")},returnAddrs:function(a,b){for(var c=0;c<a.length;c++)if(a[c].type===b)return a[c].addrs},selectAddr:function(a){$(".light").removeClass("current"),$(a.currentTarget).addClass("current");var b=this.flightSearchStore.getSearchDetails(0,"dCtyCode"),c=this.flightSearchStore.getSearchDetails(0,"aCtyCode"),d=b+c;this.flightStore.set({address:$.trim($(a.currentTarget).find(".address").text()),btime:$(a.currentTarget).find(".btime").text(),etime:$(a.currentTarget).find(".etime").text(),dstr:$(a.currentTarget).find(".dstr").text(),ext:$(a.currentTarget).find(".ext").text(),fee:$(a.currentTarget).find(".fee").text(),flag:$(a.currentTarget).find(".flag").text(),id:$(a.currentTarget).find(".id").text(),port:$(a.currentTarget).find(".port").text(),rule:$(a.currentTarget).find(".rule").text(),site:$(a.currentTarget).find(".site").text(),index:$(a.currentTarget).find(".index").text()},d),this.airportDeliveryStore.get()&&this.airportDeliveryStore.setAttr("time",null),this.forward("bookinginfo")},buildParam:function(){var a=this.flightSelectedStore.get(),b=this.flightSearchStore.get();if(!a){this.showMessage("操作已超时,请重新选择航班");var c=this;return void window.setTimeout(function(){c.back()},2e3)}var d={};d.ticketIssueCty=b.items[0].dCtyCode,d.tripType=b.tripType,d.ver=0;var e=[{aCty:b.items[0].aCtyCode,dCty:b.items[0].dCtyCode,"class":0,dDate:b.items[0].date,flightNo:a.depart.flight.flightNo,price:a.depart.cabin.price,productType:a.depart.cabin.productType,subClass:a.depart.cabin.subClass}];return 2==d.tripType&&b.items[1]&&e.push({aCty:b.items[1].aCtyCode,dCty:b.items[1].dCtyCode,"class":0,dDate:b.items[1].date,flightNo:a.arrive.flight.flightNo,price:a.arrive.cabin.price,productType:a.arrive.cabin.productType,subClass:a.arrive.cabin.subClass}),d.items=e,d},getAddress:function(){this.flightModel.setParam(this.buildParam());var a=this;this.showLoading(),this.flightModel.excute(function(b){a.hideLoading(),a.els.listBox.empty(),a.appendList(b)},function(){this.showMessage("啊哦,可能网络有点问题,加载出错喽,重新来过吧,亲!"),this.hideLoading(),this.turning()},!1,this)},appendList:function(a){if(a.deliveries.length>0){var a=this.returnAddrs(a.deliveries,16);if(a)for(var b=0;b<a.length;b++){var c=this.FlightDetailsStore.get(),d=this.temFun({datas:a[b],insurance:c,index:b,selectindex:this.flightStore.getAttr("index")?this.flightStore.getAttr("index"):1});this.els.listBox.append(d)}}this.turning()},onCreate:function(){this.render()},onLoad:function(){this.getAddress()},onShow:function(){},onHide:function(){}}));return g});