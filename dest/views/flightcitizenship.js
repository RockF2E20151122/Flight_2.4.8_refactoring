define(["libs","c","FlightModel","FlightStore","cDataSource",buildViewTemplatesPath("flightcitizenship.html")],function(a,b,c,d,e,f){var g=d.passengerEditStore.getInstance(),h=c.CountryDataModel.getInstance(),i=(d.CountryDataStore.getInstance(),b.view.extend({tpl:f,dateSource:new e,render:function(){this.viewdata.req=this.request,this.$el.html(this.tpl),this.elsBox={p_citizenship_wrap:this.$el.find("#p_citizenship_wrap"),p_citizenship_tpl:this.$el.find("#p_citizenship_tpl")},this.elHTML=_.template(this.elsBox.p_citizenship_tpl.html())},events:{"click #js_return":"backAction","click .city-group-title":"GroupTitClick","click .sub-city-box>li":"chooseNatl"},GroupTitClick:function(a){var b=$(a.currentTarget);b.parent().siblings(".cityli").find(".sub-city-box").hide(),b.next(".sub-city-box").toggle()},updatePage:function(){this.showLoading(),h.excute(function(a){this.dateSource.setData(a.countries);var b={},c={},d=g.get(),e=this.dateSource.groupBy("einitial",function(a){var c=!b[a.id];return b[a.id]=!0,c}),f=this.dateSource.filter(function(a,b){var d=(b.hotFlag<=11||14==b.id)&&!c[b.id];return c[b.id]=!0,d},function(a,b){return a.hotFlag-b.hotFlag}),h=this.elHTML({keys:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),datalist:e,hotcitys:f,scode:d.natl});this.elsBox.p_citizenship_wrap.html(h),this.selectItem=this.elsBox.p_citizenship_wrap.find(".citylistcrt"),this.hideLoading(),this.turning()},function(a){1003==a.head.errcode?window.location.href="/webapp/myctrip/#account/login?t=1&from="+encodeURIComponent("/webapp/flight/#passengerselect"):this.showToast("数据查询失败，请重试"),this.hideLoading()},!1,this)},chooseNatl:function(a){var b=$(a.currentTarget);g.setAttr("natl",b.data("scode")),g.setAttr("natlName",b.data("name")),this.back("passengeredit")},ShowAfter:function(){var a=this.selectItem.parent(),c=a.prev(".city-group-title"),d=a.parent();if(d.length)if(this.selectItem.length>1)window.scrollTo(0,0);else{c.trigger("click");var e=b.ui.Tools.getElementPos(d[0]);window.scrollTo(0,e.top-60)}},onCreate:function(){this.render()},onLoad:function(){this.updatePage()},onShow:function(){this.hideLoading(),this.ShowAfter()},onHide:function(){},backAction:function(){this.showLoading(),this.back("#passengeredit")}}));return i});