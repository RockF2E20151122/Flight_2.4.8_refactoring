define(["libs","c","CommonStore","CPageModel","CPageStore","cBasePageView","cUIBase",buildViewTemplatesPath("addpostcity.html")],function(a,b,c,d,e,f,g,h){var i=c.UserStore.getInstance(),j=e.SelectAddrStore.getInstance(),k=d.PostCityModel.getInstance(),l=e.PostCityStore.getInstance(),m=f.extend({districtData:null,preOpenGroup:null,render:function(){this.viewdata.req=this.request,this.$el.html(h),this.els={elcitylisttpl:this.$el.find("#post-citylist-tpl"),elcitylistbox:this.$el.find("#postcitylistbox")},this.cityListTplfun=_.template(this.els.elcitylisttpl.html())},events:{"click .city-group-title":"cityGroupTitleClick","click .city-item":"cityItemonClick","click #js_city_return":"onBack"},onCreate:function(){this.render()},loadUser:function(){if(!this.uid)if(i.isLogin()){var a=i.getUser();this.uid=a.UserID}else this.uid=b.utility.getGuid()},onLoad:function(){this.loadUser();var a=this,b=j.getAttr("prvnId",this.uid)||"31",c=j.getAttr("prvnName",this.uid)||"上海市",d=j.getAttr("ctyName",this.uid)||0;this.districtData=l.get(),this.districtData?this.updatePage(b):(this.showLoading(),k.excute(function(c){a.hideLoading(),a.cityStore.set(c,a.uid),a.districtData=c,a.updatePage(b)},function(){a.hideLoading()})),this.$el.find("h1").text(c),d&&(this.preOpenGroup=$(".citylistclick div"))},updatePage:function(a){for(var b={},c=0,d=this.districtData.length;d>c;c++)if(this.districtData[c].treeKey==a){b=this.districtData[c];break}var e=b.citys;if("市辖区"==e[0].name||"县"==e[0].name){for(var f=[],g=0,h=e.length;h>g;g++)for(var i=e[g],k=0,l=i.contries.length;l>k;k++)contry=i.contries[k],contry.cryName=0==i.name.indexOf("县")?b.name:i.name,f.push(contry);b.citys=f,b.isDirect=!0}else b.isDirect=!1;b.curCtyName=j.getAttr("ctyName",this.uid),b.curDstrName=j.getAttr("dstrName",this.uid),this.els.elcitylistbox.html(this.cityListTplfun(b)),this.turning()},onShow:function(){this.setTitle("选择城市")},onHide:function(){},cityGroupTitleClick:function(a){var b=$(a.currentTarget),c=b.attr("data-pkey"),d=b.attr("data-key"),e=b.attr("data-name"),f=b.parent("li"),h=(j.getAttr("from",this.uid),g.getElementPos(b.next()[0])),i=$(window).height(),k=$(window).scrollTop();j.rollback(["ctyId","ctyName","cty","dstrId","dstr","dstrName"]),c?(j.setAttr("ctyId",c,this.uid),j.setAttr("ctyName",$.trim(b.attr("data-ctyName")),this.uid),j.setAttr("cty",$.trim(b.attr("data-ctyName")),this.uid),j.setAttr("dstrId",d,this.uid),j.setAttr("dstrName",e,this.uid),j.setAttr("dstr",e,this.uid),j.setAttr("from","",this.uid),this.back("bookinginfo")):(this.preOpenGroup?this.preOpenGroup.attr("data-key")==b.attr("data-key")?(b.toggleClass("newarr_up"),b.toggleClass("newarr_down"),f.toggleClass("citylistclick")):(this.preOpenGroup.removeClass("newarr_up"),this.preOpenGroup.addClass("newarr_down"),this.preOpenGroup.parent("li").removeClass("citylistclick"),b.toggleClass("newarr_up"),b.toggleClass("newarr_down"),f.toggleClass("citylistclick")):(b.toggleClass("newarr_up"),b.toggleClass("newarr_down"),f.toggleClass("citylistclick")),this.preOpenGroup=b,j.setAttr("ctyId",d,this.uid),j.setAttr("ctyName",e,this.uid),j.setAttr("cty",e,this.uid),j.setAttr("dstrId","",this.uid),j.setAttr("dstrName","",this.uid),j.setAttr("dstr","",this.uid)),Math.abs(h.top-i-k)<b.height()&&window.scrollTo(0,k+b.height())},cityItemonClick:function(a){{var b=$(a.currentTarget),c=b.attr("data-key"),d=b.html();j.getAttr("from",this.uid)}j.rollback(["dstrId","dstrName","dstr"]),j.setAttr("dstrId",c,this.uid),j.setAttr("dstrName",d,this.uid),j.setAttr("dstr",d,this.uid),j.setAttr("from","",this.uid),this.back("bookinginfo")},onBack:function(){j.rollback(["ctyId","ctyName","cty","dstrId","dstrName","dstr"]),this.back("addpostprovince")}});return m});