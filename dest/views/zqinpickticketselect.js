define(["libs","c","FlightModel","FlightStore",buildViewTemplatesPath("zqinpickticketselect.html")],function(a,b,c,d,e){var f=(b.ui,b.base,b.view.extend({pageid:"214037",tpl:e,calendar:null,curTab:1,flightPickTicketModel:c.FlightPickTicketModel.getInstance(),flightPickTicketSelectStore:d.FlightPickTicketSelectStore.getInstance(),flightSelectedStore:d.FlightSelectedInfo.getInstance(),flightSearchStore:d.FlightSearchStore.getInstance(),render:function(){this.viewdata.req=this.request,this.els={},this.htmltplfun=_.template(this.tpl)},events:{"click #js_return":"backAction","click #js_listbox li":"tapItemAction"},backAction:function(){this.back("bookinginfo")},tapItemAction:function(a){var b=$(a.currentTarget),c=b.data("type");switch(c){case 1:b.siblings("li").removeClass("current"),b.addClass("current"),this.flightPickTicketSelectStore.setAttr("type",c),this.back("bookinginfo");break;case 2:this.forward("postinfo");break;case 8:this.forward("zqincity");break;case 16:this.forward("zqinairport")}},buildParam:function(){var a=this.flightSelectedStore.get(),b=this.flightSearchStore.get(),c={};c.ticketIssueCty=b.items[0].dCtyCode,c.tripType=b.tripType,c.ver=0;var d=[{aCty:b.items[0].aCtyCode,dCty:b.items[0].dCtyCode,"class":0,dDate:b.items[0].date,flightNo:a.depart.flight.flightNo,price:a.depart.cabin.price,productType:a.depart.cabin.productType,subClass:a.depart.cabin.subClass}];return 2==c.tripType&&b.items[1]&&d.push({aCty:b.items[1].aCtyCode,dCty:b.items[1].dCtyCode,"class":0,dDate:b.items[1].date,flightNo:a.arrive.flight.flightNo,price:a.arrive.cabin.price,productType:a.arrive.cabin.productType,subClass:a.arrive.cabin.subClass}),c.items=d,c},updatePage:function(a){var b=this.buildParam(),c=this.flightPickTicketSelectStore.get()||{type:1};this.flightPickTicketModel.setParam(b),this.flightPickTicketModel.excute(function(b){var d=this.getCurrentItems(b);this.randerPage({items:d,selected:c}),a.call(this)},function(a){a&&a.msg?this.showToast(a.msg,2):this.showToast("数据加载失败",2)},!1,this)},getCurrentItems:function(a){for(var b=a.deliveries||[],c={},d=0,e=b.length;e>d;d++)c[b[d].type]=b[d];return c},randerPage:function(a){this.$el.html(this.htmltplfun(a))},onCreate:function(){this.render()},onLoad:function(){this.showLoading(),this.updatePage(function(){this.hideLoading(),this.turning()})},onShow:function(){this.setTitle("选择配送方式")},onHide:function(){}}));return f});