"use strict";define(["libs","c","cUI","flight/utility/utility"],function(a,b,c,d){var e=(b.base,new b.base.Class({__propertys__:function(){this.stores=null},initialize:function(a){this.opts=_.extend({},a),this.viewPort=this.opts.viewPort,this.parentView=this.opts.parentView,this.stores=this.parentView.stores},EVENTS:{FORMATPATAMESSAGE:"formatPataMessage",ACCOUNTTOTALPRICE:"accountTotalPrice"},formatPataMessage:function(a,b,c){var d="";return a-b>50?d+=c+"机票价格上调为：&yen;"+a+"</br>":0>a-b&&(d+=c+"机票价格下调为：&yen;"+a+"</br>"),d},accountTotalPrice:function(){var a=0,b=null,c=1,e=this.stores.passengerQueryStore.getAttr("passengers")||[],f=this.stores.passengerQueryStore.getAttr("validSelCount"),g=this.stores.flightDetailsStore.get(),h=this.stores.flightOrderStore,i=(this.stores.packageSelectStore,this.stores.flightDeliveryStore.get(this.parentView.UserID)||{type:1}),j=_.filter(e,function(a){return 1==a.selected&&-1!=a.ticketType}).length;if(this.stores.passengerQueryStore.setAttr("validSelCount",j),f=this.stores.passengerQueryStore.getAttr("validSelCount"),!g||!g.items||!g.items.length)return this.parentView.showAlert(),0;for(var k=0;k<g.items.length;k++)for(var l=(g.items[k],0),m=e.length;m>l;l++)c="undefined"!=typeof e[l].ticketType?e[l].ticketType:1,b=DataControl.getTicketPolicy(c,k),1==+e[l].selected&&(a=d.add(a,b.price,b.fuelCost,b.tax));if(+h.getAttr("selInsure")&&!g.ispackage&&g.insurances&&g.insurances.length&&(a=d.add(a,d.mul(f,g.insurances[0].min,g.insurances[0].price))),g.ispackage&&g.pkglist&&g.pkglist.length&&(a=d.add(a,this.getInsureOrLipingTotalPrice(f))),32==i.type){var n=this.stores.flightDeliveryStore.getAttr("paytype"),o=i.deliveryInfo.fee||i.deliveryInfo.sendFee;(2==n||0==n)&&(a=d.add(a,o))}return a},getInsureOrLipingTotalPrice:function(a){{var b=this.stores.flightDetailsStore.get(),c=this.stores.packageSelectStore.get(this.parentView.uid).pkgtype;this.stores.passengerQueryStore.get()}if(!b.ispackage||!b.pkglist.length)return 0;var e=b.pkglist.filter(function(a){return a.basicinfo.pkgtype==c});if(e.length){var f=e[0].packageinfo.psgs.filter(function(a){return 1==a.psgtype});return e[0].count=(f.length?+f[0].min:1)*a,d.mul(e[0].count,+e[0].price)}}}));return e});