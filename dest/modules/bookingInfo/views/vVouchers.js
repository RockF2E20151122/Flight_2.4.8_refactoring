"use strict";define(["libs","c","cUI","CommonStore","FlightStore","vVouchersCorporater",buildViewTemplatesPath("../modules/bookingInfo/templates/tVoucher.html"),"cWidgetFactory","cWidgetCalendar"],function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=(b.base,h.create("Calendar"),new b.base.Class({__propertys__:function(){this.stores=null},initialize:function(a){this.opts=_.extend({},a),this.parentView=this.opts.parentView,this.stores=this.parentView.stores,this.Calendar=h.create("Calendar"),this.$el=this.opts.viewPort,this.data=this.opts.data,this.$el.append(g),this.render(),i=this.stores.flightDeliveryStore,j=this.stores.userStore,k=this.stores.flightDetailsStore,l=this.stores.flightOrderStore,m=this.stores.postAddressStorage,n=this.stores.mdStore,o=this.stores.flightSearchStore,p=this.stores.addrListStore,q=this.stores.selAddrStore,r=this.stores.zqInAirportSelectStore,s=this.stores.selFlightInfoStore,t=this.stores.airportDeliveryStore,u=this.stores.invoiceTitleStore,v=this.stores.passengerQueryStore,w=this.stores.flightOrderInfoInviceStore,x=this.parentView.models.addrListModel,this.events()},render:function(){this.elsBox={delivery_tpl:this.$el.find("#deliverytpl"),deliverytpl_tab:this.$el.find("#deliverytpl_tab"),deliverytpl_cost:this.$el.find("#deliverytpl_cost"),deliverytpl_mail_1:this.$el.find("#deliverytpl_mail_1"),deliverytpl_mail_2:this.$el.find("#deliverytpl_mail_2"),deliverytpl_zq:this.$el.find("#deliverytpl_zq"),invoiceboxtpl:this.$el.find("#invoice_box")},this.deliverytplfun=_.template(this.elsBox.delivery_tpl.html()),this.delmailfun_1=_.template(this.elsBox.deliverytpl_mail_1.html()),this.delmailfun_2=_.template(this.elsBox.deliverytpl_mail_2.html()),this.delzqfun=_.template(this.elsBox.deliverytpl_zq.html()),this.deltabfun=_.template(this.elsBox.deliverytpl_tab.html()),this.delcostfun=_.template(this.elsBox.deliverytpl_cost.html()),this.invoiceboxfun=_.template(this.elsBox.invoiceboxtpl.html())},events:function(){$(this.$el).on("click",".flight-bxinfo-kdf dd",this.selectPaymentType.bind(this)),$(this.$el).on("click","#intype",this.changeInvoiceType.bind(this))},selectPaymentType:function(a){{var b=$(a.currentTarget),c=1;i.getAttr("paytype")}if(!b.hasClass("flight-bxinfo-kdf-current")){b.addClass("flight-bxinfo-kdf-current"),b.siblings("dd").removeClass("flight-bxinfo-kdf-current"),c=parseInt(b.data("paytype")),i.setAttr("paytype",c);{i.getAttr("deliveryInfo")}this.parentView.trigger(this.parentView.EVENTS.UPDATEORDERPRICE)}},renderInvoice:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){{var p=this;!function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(e.len=a.length,e.needinv=d.needinv,b.elsBox.delivery_box.html(f(e)),32==e.type&&$("#gift-card-tips").show(),o=new c.cuiSwitch({rootBox:b.$el.find("#invoice_switch"),checked:a.length?!(!e.type||+e.type<=1):!1,changed:function(){p.reimbursementAction(b,this),b.models.postCityModel.excute(function(){},function(){},!1,this)}}),!a.length||!e.type||+e.type<=1||b.models.postCityModel.excute(function(){},function(){},!1,this),a.length&&(b.$el.find(".js_del_tab").html(n(e)),a&&a.length&&32==a[0].type)){var q=function(c){a[0].exinfo.pays.length<2&&(!a[0].exinfo.pays[0]||a[0].exinfo.pays[0]&&0!=a[0].exinfo.pays[0].paytype)&&a[0].exinfo.pays.push({paytype:0,amount:0}),h.setAttr("pays",a[0].exinfo.pays,b.UserID),e=h.get(b.UserID),e.rc=c,h.setAttr("rc",c),e.paytype=0==c?-1==e.paytype||"undefined"==typeof e.paytype?b.getPayType():e.paytype:-1,h.setAttr("paytype",e.paytype),e.islogin=i.isLogin(),e.fee=a[0].exinfo.fee,e.isLogin=i.isLogin(),b.$el.find(".js_del_cost").html(m(e)),p.parentView.trigger(p.parentView.EVENTS.UPDATEORDERPRICE)};b.repeatAddrCheck(i,j,k,l,q,b)}}(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o)}},updateInvoiceBox:function(a,b,c,d,e,f,g){var h={},i=d.isLogin()?d.getUser().UserID:null,j=e.get();null!=j&&j.needinv&&(h=this.QueryInvoiceInfoData(a,c,f,b,h,i,this.stores.flightDetailsStore),f.setAttr("iinfo",h),g.$el.find("#js_invoice_box").html(this.invoiceboxfun(h)))},verifyAddrInput:function(a,b,c,d,e){c=$.trim(c),d=d.replace(/[\s]/g,""),e=$.trim(e);var f=c.length,g=!0;0==f&&(g=!1),b.setAttr("IsWriteAddressee",!0),(c.match(/^[a-z0-9]+$/i)&&(4>f||f>20)||c.match(/[\u4e00-\u9fa5]/)&&(1>f||f>10))&&(g=!1),0==d.length&&(g=!1),b.setAttr("IsDeliveryAddress",!0),(d.match(/^[a-z0-9]+$/i)&&d.length>100||d.match(/[\u4e00-\u9fa5]/)&&d.length>50)&&(g=!1),0==e.length&&(g=!1),b.setAttr("IsDeliveryPostCode",!0);var h=/^[0-9]\d{5}$/;return h.test(e)||(g=!1),g?g:(0,a(DataControl.TIPICONS.RED,"#js_addrList>span","请选择报销凭证的配送地址",!0),!1)},PickTicketParam:function(a,b){var c=a.get(),d=b.get(),e={};return e.triptype=d.tripType,e.ver=0,e.prdid=c.depart.cabin.pid,e},getCurrentItems:function(a){for(var b=a.deliveries||[],c=function(a){var b=null;a=a||[],_.sortBy(a,function(a){return a.paytype});var c=_.filter(a,function(a){return 3==a.paytype})[0];c&&(b=a[0],a[0]=c,a[a.length-1]=b),a=_.filter(a,function(a){return 0!=a.paytype})},d=0,e=b.length;e>d;d++)switch(b[d].type){case 32:b[d].key="快递",b[d].index=0,c(b[d].exinfo.pays);break;case 2:b[d].key="邮寄",b[d].index=1;break;case 16:b[d].key="机场自取",b[d].index=2;break;default:b.splice(d,1),d--,e=b.length}return _.sortBy(b,function(a){return a.index})},inTitleChange:function(a,b,c,d){var e={},f=a.isLogin()?a.getUser().UserID:this.parentView.UserID;e.title=$("#js_invoice_title")?$("#js_invoice_title").val():"",b.setAttr(f,e),c.setAttr("iinfo",e),e.title.length&&d("#js_invoice_title")},changeInvoiceType:function(){if(!this.stores.flightDetailsStore.get())return void this.parentView.showAlert();if(this.invoiceinfo=this.stores.flightDetailsStore.getAttr("invoiceinfo")||[],1!=this.invoiceinfo.length){var a=this.stores.flightOrderInfoInviceStore.getAttr("invoiceinfo")||{},c=0;for(var d in this.invoiceinfo)this.invoiceinfo[d].key=this.invoiceinfo[d].inname,this.invoiceinfo[d].index=d,a.intype==this.invoiceinfo[d].intype&&(c=d);var e=this,f=new b.ui.ScrollRadioList({title:"凭证类型",index:c,data:this.invoiceinfo,itemClick:function(a){e.$el.find("#intype").text(a.key),e.$el.find("#intype").data("intype",a.index),e.stores.flightOrderInfoInviceStore.setAttr("invoiceinfo",{intype:a.intype,inname:a.key,len:e.invoiceinfo.length})}});f.show()}}}));return y=b.base.implement(y,f)});