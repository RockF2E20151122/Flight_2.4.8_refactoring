define(function(a){var b=a("c"),c=Backbone.View.extend({EVENTS:{CHECKTICKETAMOUNT:"checkTicketAmount"},initialize:function(a){this.opts=$.extend(!0,{},a),this.viewPort=this.opts.viewPort,this.parentView=this.opts.parentView,this.stores=this.parentView.stores,this.models=this.parentView.models,this.render()},fnCheckRepeatOrder:function(){var a=this.models.RepeatOrderCheckModel,c=this.stores.repeatOrderCheckStore,d=this;a.getDataWithSync(function(a){var e,f,g;a.rc?(e=a.rmsg,g=e.split(","),f=g.length&&g.map(function(a){var b=a.match(/\d/g);return b&&b.length?b.join(""):void 0}).filter(function(a){return a}),c.set({msg:e,repeatOrder:f},d.parentView.UserID),d.parentView.isRepeatOrder=!1,d.parentView.repeatAlert=new b.ui.Alert({title:"重复订单提醒",message:e,buttons:[{text:"取消",click:function(){this.hide(),localStorage.setItem("__REPEAT_ORDER",!1),c.remove()}},{text:"查看订单",click:function(){d.parentView.jump(f&&f.length>1?"/webapp/myctrip/#orders/flightorderlist?from="+encodeURIComponent("/webapp/flight/#bookinginfo"):"/webapp/flight/#flightorderdetail?from="+encodeURIComponent("/webapp/flight/#bookinginfo")+"&&oid="+f[0]),this.hide(),localStorage.setItem("__REPEAT_ORDER",!0)}},{text:"继续预订",click:function(){this.hide(),d.parentView.isRepeatOrder=!0,d.parentView.payAction(),localStorage.setItem("__REPEAT_ORDER",!1),c.remove()}}]}),d.parentView.repeatAlert.show()):d.parentView.isRepeatOrder=!0},function(a){d.parentView.hideLoading(),d.parentView.isRepeatOrder=!0,a&&a.msg?d.parentView.showToast(a.msg,2,function(){}):d.parentView.showToast("数据加载失败",2,function(){})},!0)},checkTicketAmount:function(a){var b=this.stores.mdStore,c=this.stores.flightDetailsStore,d=c.get(),e=d.items[0].policy.qty;return d.items.length>1&&+e>+d.items[1].policy.qty&&(e=d.items[1].policy.qty),0>=+e?(this.parentView.showAlert("抱歉，您选择的价格舱位已售完，请重新查询选择其它价格舱位预订。",!1),b.increaseCntByKey("NextStepNotPassClick"),!0):+e<a.length?(this.parentView.showAlert("很抱歉，机票数量有限，最多只能添加"+e+"名乘机人",!1),b.increaseCntByKey("NextStepNotPassClick"),!0):void 0}});return c});