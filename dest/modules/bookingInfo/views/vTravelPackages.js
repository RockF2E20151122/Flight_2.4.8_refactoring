"use strict";define(["c","libs",buildViewTemplatesPath("../modules/bookingInfo/templates/tTravelPackages.html")],function(a,b,c){var d=(a.base,new a.base.Class({__propertys__:function(){this.viewName="TravelPackages",this.opts=this.opts||{},this.parentView=null},setBoxes:function(){this.lxtcBox=this.viewPort.find("#lxtc_box"),this.packageBox=this.viewPort.find("#package"),this.packageSelectBox=this.viewPort.find("#js_packageSelected")},setTemplate:function(){this.viewPort.append(c),this.lxtcBoxtplfun=_.template(this.viewPort.find("#lxtctpl").html()),this.packageBoxtplfun=_.template(this.viewPort.find("#packagetpl").html()),this.packageSelecttplfun=_.template(this.viewPort.find("#packageSelecttpl").html())},changeOpts:function(a){this.opts=$.extend(!0,this.opts,a),this.viewPort=this.opts.viewPort,this.parentView=this.opts.parentView,this.stores=this.parentView.stores},EVENTS:{TOGGLEPACKAGEDESC:"togglePackageDesc",UPDATEPACKAGETPL:"updatePackageTpl"},initialize:function(a){this.changeOpts(a),this.setBoxes(),this.setTemplate(),this.fireEvents()},fireEvents:function(){this.parentView.on(this.parentView.EVENTS.TOGGLEPACKAGEDESC,this.togglePackageDesc.bind(this)),this.parentView.on(this.parentView.EVENTS.UPDATEPACKAGETPL,this.updatePackageTpl.bind(this))},setAmtByPackageData:function(a,b,c,d){var e=this.parentView.uid,f=null!=c.get(e)?c.get(e).pkgtype||0:0;return a&&d.packageData&&(1==f||2==f)&&(b+=d.packageData.price*d.packageData.min),b},setPaymentParam:function(a,b){if(b)for(var c=this.stores.flightDetailsStore.get(),d=this.stores.packageSelectStore.get(this.uid).pkgtype,e=a.pkginfo,f=0;f<e.length;f++){var g=e[f];if(c.ispackage){if(g.basicinfo.pkgtype==d){var h=g.packageinfo.psgs.filter(function(a){return 1==a.psgtype}),i=h.length?h[0].min:1;b.pkglst.push({pkgtype:g.basicinfo.pkgtype,pkgsubtype:g.basicinfo.pkgsubtype,pkgid:g.basicinfo.pkgid,pkgname:g.basicinfo.pkgname,currency:g.currency,price:g.price,cnt:i,amount:i*g.price})}}else if(1==g.basicinfo.pkgtype&&this.stores.flightOrderStore.getAttr("selInsure")){var i=c.insurances[0].min;b.pkglst.push({pkgtype:g.basicinfo.pkgtype,pkgsubtype:g.basicinfo.pkgsubtype,pkgid:g.basicinfo.pkgid,pkgname:g.basicinfo.pkgname,currency:g.currency,price:g.price,cnt:i,amount:i*g.price})}}return b},updatePackageTpl:function(a){if(DataControl.packageData){DataControl.packageData.count=DataControl.packageData.min*(a||0),DataControl.packageData.pkgcount=DataControl.packageData.count;var b=this.packageBoxtplfun(DataControl.packageData);this.packageBox.html(b)}},render:function(a,b,c){this.setHtml(a,b,c)},togglePackageDesc:function(a){this.viewPort.find("#insuranceLink").length>0&&(a?this.viewPort.find("#insuranceLink").show():this.viewPort.find("#insuranceLink").hide())},packageSelectAction:function(a){var b=this.parentView.uid,c=$(a.currentTarget);c.hasClass("selected")||($(".js_package_select").removeClass("flight-selected"),c.addClass("flight-selected"),this.packageBox.find(".flight-ins").html(c.html()),this.packageBox.find(".flight-ins").data("type",+c.data("type")),this.stores.packageSelectStore.setAttr("pkgtype",+c.data("type"),b)),this.togglePackageSelect(),this.togglePackageDesc(1==+c.data("type")?!0:!1)},togglePackageSelect:function(){this.packageSelectBox.toggle(),this.packageBox.hasClass("flight-arrdown4")?this.packageBox.removeClass("flight-arrdown4").addClass("flight-arrup4"):this.packageBox.removeClass("flight-arrup4").addClass("flight-arrdown4")},setSelectHtml:function(){var a=this,b=this.parentView.uid,c=this.stores.flightDetailsStore.get()||{};if(c.selCount=this.stores.passengerQueryStore.getAttr("validSelCount"),c.pkgtype=this.stores.packageSelectStore.getAttr("pkgtype",b),c){var d=this.packageSelecttplfun(c);this.packageSelectBox.html(d),this.packageSelectBox.find(".js_package_select").bind("click",$.proxy(a.packageSelectAction,a))}},showReadMe:function(){var a=(this.opts.Mask,['<div class="flight-mask"   >','<div class="flight-mask-cnt" style=" color:rgba(255, 255, 255, 1);font-size:14px; " >','<p">携程礼品卡</p>',"<br/>","<p>携程旅行网根据不同的地区和出票方式，提供多款航空意外伤害保险产品：</p>","<p>1 、保险名称：新华“出行关爱”交通工具意外伤害保险、“e路泰康”航空意外伤害保险、太平洋“随心太保”意外险保障计划、人保健康的”携程飞翔无忧”航空意外伤害保险；</p>","<p>2 、份数限制：购买上限 5 份；</p>","<br/><br/>",'<p">航空意外险</p>',"<br/>","<p>携程旅行网根据不同的地区和出票方式，提供多款航空意外伤害保险产品：</p>","<p>1 、保险名称：新华“出行关爱”交通工具意外伤害保险、“e路泰康”航空意外伤害保险、太平洋“随心太保”意外险保障计划、人保健康的”携程飞翔无忧”航空意外伤害保险；</p>","<p>2 、份数限制：购买上限 5 份；</p>","<p>3 、保险有效期：指被保险人每次以乘客身份，乘坐电子保单载明的合法商业运营的客运飞机班次，并遵守承运人关于安全乘坐的规定，自持有效机票检票并进入所乘客运飞机客舱时起至抵达机票载明的终点离开所乘客运飞机客舱的期间内遭受意外伤害所导致的保险责任；机客舱的期间内遭受意外伤害所导致的保险责任；机客舱的期间内遭受意外伤害所导</p>","</div>","</div>"].join("")),a=$(a);this.parentView.mask||(this.parentView.mask=a,$("body").append(a),a.click(function(){$(this).hide()})),this.parentView.mask.show()},setHtml:function(a,b,c){var d=this;if(0,a){var e=this.stores.userStore,f=e.isLogin()?e.getUser().UserID:null,g=1;null!=f&&(g=b.get(f).pkgtype||1),a.pkgtype=g;var h=c.get(),i=[];if(a.ispackage&&a.pkglist.length){if(i=a.pkglist.filter(function(a){return a.basicinfo.pkgtype==g}),i.length){var j=i[0].packageinfo.psgs.filter(function(a){return 1==a.psgtype});i[0].count=(j.length?j[0].min:1)*(h.validSelCount||0),i[0].min=j.length?j[0].min:1,a.pkgcount=+i[0].count,a.pkgprice=+i[0].price;var k=this.packageBoxtplfun(i[0]);this.packageBox.show().html(k),this.packageBox.find(".flight-ins").length>0&&this.packageBox.find(".flight-ins").bind("click",$.proxy(d.togglePackageSelect,d)),this.packageBox.find(".flight-labq").length>0&&this.packageBox.find(".flight-labq").bind("click",$.proxy(d.showReadMe,d)),this.setSelectHtml(),this.parentView.vInsurance.hideBox();var l=1!=g?!1:!0;this.togglePackageDesc(l),DataControl.packageData=i[0]}}else this.parentView.vInsurance.showBox(),this.packageBox.hide(),this.packageSelectBox.hide();var m=this.lxtcBoxtplfun(a);this.lxtcBox.html(m),a.hasTravalPackage?(this.viewPort.find("#package-desc").show(),this.viewPort.find("#flightInfo .flight-pnttips").addClass("black-text")):(this.viewPort.find("#flightInfo .flight-pnttips").removeClass("black-text"),this.viewPort.find("#package-desc").hide())}}}));return d});