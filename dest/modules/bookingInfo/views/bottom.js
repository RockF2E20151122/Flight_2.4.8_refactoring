define(["FlightStore","CPageStore","c","flight/utility/utility"],function(a,b,c,d){function e(a){this._this=a}function f(a,b){b=c.base.Date.parse(b),b=c.base.Date.format(b,"Y/m/d");var d=a.getTime(),e=new Date(b.replace(/-/g,"/")).getTime();return 14>=(d-e)/864e5?!0:!1}var g=a.FlightDetailsStore.getInstance(),h=b.passengerQueryStore.getInstance(),i=b.passengerEditStore.getInstance(),j={ADULT:1,CHILD:2,BABY:3,NEWBORN:4};return e.prototype={passengerData:{},PassEditData:{},reqFlags:{DETAIL:!1,PASSENGERS:!1,HASPASSENGER:!1},errorType:null,errorMessage:null,tipIconType:"",TIPICONS:{BLUE:"flight-errtips-blue",RED:"flight-errtips-red"},errorInfo:null,allErrorInfo:[],loadPassengger:function(){var a=h.get();if(a){if(a.selCount=0,1!=a.flightType&&userStore.isLogin())for(var b=0,c=a.passengers.length;c>b;b++)delete a.passengers[b].selected,delete a.passengers[b].defaIdCard;a.flightType="1",1==a.passengers.length&&0!=a.passengers[0].selected&&d.checkPassenger(this._this,this._this.showToast,a.passengers)&&(a.passengers[0].selected=1);for(var b=0,c=a.passengers.length;c>b;b++){if(a.passengers[b].idcards.sort(function(a,b){var c=e.idCardTypeSort[a.type]&&e.idCardTypeSort[a.type].num||1e3,d=e.idCardTypeSort[b.type]&&e.idCardTypeSort[b.type].num||1e3;return d>c?-1:c>d?1:0}),!a.passengers[b].defaIdCard)if(a.passengers[b].idcards&&a.passengers[b].idcards.length){var f=a.passengers[b].idcards[0].type;e.idCardTypeSort[f]?(a.passengers[b].defaIdCard=a.passengers[b].idcards[0],a.passengers[b].defaIdCard.name=e.idCardTypeSort[f]&&e.idCardTypeSort[f].name):a.passengers[b].defaIdCard=null}else a.passengers[b].defaIdCard=null;if(0!=a.passengers[b].selected&&userInfo&&userInfo.UserName&&(userInfo.UserName==a.passengers[b].ename||userInfo.UserName==a.passengers[b].cname)&&a.passengers[b].idcards.length>0&&a.passengers[b].defaIdCard){var g=[];g[0]=a.passengers[b],this._this.checkPassenger(g)&&(a.passengers[b].selected=1)}1==a.passengers[b].selected&&a.selCount++}for(var i in a)this.passengerData[i]=a[i];this.savePassengger()}else this.passengerData={}},savePassengger:function(){if(!c.utility.validate.isEmptyObject(this.passengerData)){var a={};for(var b in this.passengerData)a[b]=this.passengerData[b];var d=h.getTag();h.set(a,d)}},loadPassEditStore:function(){var a=i.get();a.birth&&(a.birth=c.base.Date.parse(a.birth).format("Ymd"));for(var b=this.idCardsDict(),e=0;e<b.length;e++){b[e].no="",b[e].opr=1,b[e].flag=2,b[e].expiryDate="2099/1/1";for(var f=0;f<a.idcards.length;f++)if(b[e].type==a.idcards[f].type)for(var g in a.idcards[f])b[e][g]=a.idcards[f][g]}a.idcards=b,1==a.defaIdCard.type&&(a.idcards[0].no=d.formatCardNo(a.idcards[0].no),a.defaIdCard.no=d.formatCardNo(a.defaIdCard.no));for(var g in a)this.PassEditData[g]=a[g];for(var g in this.PassEditData)this.PassEditData[g]=a[g]},savePassEditStore:function(){if(!c.utility.validate.isEmptyObject(this.PassEditData)){var a={};this.PassEditData.selected=1;for(var b in this.PassEditData)a[b]=this.PassEditData[b];a.idcards=[],a.defaIdCard.no=a.defaIdCard.no.replace(/\s/g,""),a.idcards[0]=a.defaIdCard,a.birth&&(a.birth=c.base.Date.parse(a.birth).format("Y-m-d")),i.set(a)}},saveEditInQueryStore:function(){if(!c.utility.validate.isEmptyObject(this.PassEditData)){this.savePassEditStore();var a=h.get(),b=i.get(),d=!0;a||(a={passengers:[]});for(var e=0;e<a.passengers.length;e++)if(a.passengers[e].inforId==b.inforId){d=!1,a.passengers.splice(e,1),a.passengers.push(b);break}d&&a.passengers.push(b),a.flightType=1;var f=h.getTag();h.set(a,f)}},deletePsgById:function(a){var b=h.get(),c=h.getAttr("selCount");b&&b.passengers&&_.each(b.passengers,function(d,e){return d.inforId==a?(b.passengers.splice(e,1),c--,!1):void 0}),h.setAttr("passengers",b.passengers),h.setAttr("selCount",c)},getPsgById:function(a){var b=h.getAttr("passengers"),c=null;return b&&_.each(b,function(b){return b.inforId==a?(c=b,!1):void 0}),c},handleDirtyPassegners:function(a){var b=/^[\u4e00-\u9fa5]{2,14}$/,e=/^[A-Za-z0-9]+$/g,f=[],g=!1,i=[];_.each(a,function(a,h){1!=a.selected||"undefined"!=typeof a.edit&&"undefined"!=typeof a.empty||(a.firstName="",a.lastName="",a.ename&&(a.ename.indexOf("/")>0?(f=a.ename.split("/"),a.firstName=f[0],a.lastName=f[1]):a.firstName=a.ename),a.defaIdCard&&1==a.defaIdCard.type?(a.empty=a.cname||a.defaIdCard.no?!1:!0,a.edit=a.empty?!0:!1,a.edit===!1&&(a.edit=!(a.cname&&b.test(a.cname)&&c.utility.validate.isIdCard(a.defaIdCard.no))),a.edit?i.push(h):""):(a.empty=a.cname||a.ename||a.birth?!1:!0,a.edit=a.empty?!0:!1,a.edit===!1&&(g=d.testBirth(this._this.showToast,a.birth,!1,a.defaIdCard.type),g&&(g=!!(a.defaIdCard.no&&a.defaIdCard.no<=20&&e.test(a.defaIdCard.no))),g&&(g=!!(a.ename&&b.test(a.cname)||this._this.validateFirstName(this._this.showToast,a.firstName,!1)&&this._this.validateLastName(this._this.showToast,a.lastName,!1)&&a.firstName.length+a.lastName.length<=26)),a.edit=!g),a.edit?i.push(h):""))});for(var j=1;j<i.length;j++)a.splice(j,1);h.setAttr("passengers",a)},getBirth:function(a){var b="";return b=1!=a.defaIdCard.type?a.birth:a.defaIdCard.no?a.defaIdCard.no.substring(6,14):""},getAge:function(a,b){a=c.base.Date.parse(a),a=c.base.Date.format(a,"Ymd"),b="undefined"==typeof b?!0:!1;var d,e,h=g.getAttr("items");try{d=h.length>1?h[1].basicInfo.dTime:h[0].basicInfo.dTime,e=h[0].basicInfo.dTime,d=(d||"").replace(/-/g,"/"),d=new Date(d),e=(e||"").replace(/-/g,"/"),e=new Date(e),0}catch(i){d=this._this.getServerDate(),e=this._this.getServerDate(),0}var j=d.getMonth()+1,k=d.getDate(),l=d.getFullYear()-a.substring(0,4)-1;return(a.substring(4,6)<j||a.substring(4,6)==j&&a.substring(6,8)<=k)&&l++,l=f(e,a,l)?-2:l},getPsgType:function(a,b){if(b){var c=b.defaIdCard&&1==b.defaIdCard.type?d.getBirth(b.defaIdCard.no):b.birth;if(""==c)return j.ADULT;a=this.getAge(c)}return a>=12?j.ADULT:a>=2?j.CHILD:j.BABY},getSelectedPassengers:function(){var a=h.get(),b=j.ADULT,c=[];if(a&&a.passengers)for(var d in a.passengers){var e=a.passengers[d];if(b=this.getPsgType(null,e),1==+e.selected){if(!this.isSupportChild()&&b==j.CHILD||!this.isSupportBaby()&&b==j.BABY)continue;c.push(e)}}return c},updatePassengersTicketType:function(a){if(!a)return!1;var b=a.passengers||[],c=a.policy||g.getAttr("items")[0].policy,d=c.isApplyChild,e=this.hasChildTicket(),f=this.hasBabyTicket(),i=e&&c.childPolicy.isApply,k=this.getTicketAmtByType(j.ADULT),l=this.getTicketAmtByType(j.CHILD),m=this.getTicketAmtByType(j.BABY),n=e&&k>l?!0:!1,o=f&&(e&&l>m||!e)?!0:!1,p=f&&k>m?!0:!1,q=j.ADULT,r=this;$(b).each(function(a,b){q=r.getPsgType(null,b),q!=j.ADULT?q==j.CHILD?b.ticketType==j.ADULT&&d||b.ticketType==j.CHILD&&e||(b.ticketType=e?d?n?j.CHILD:j.ADULT:j.CHILD:d?j.ADULT:-1):q==j.BABY&&(b.ticketType==j.ADULT&&d||b.ticketType==j.CHILD&&i||b.ticketType==j.BABY&&f||(b.ticketType=f?e&&d?i&&n?o?j.BABY:j.CHILD:p?j.BABY:j.ADULT:e?i?o?j.BABY:j.CHILD:j.BABY:d?p?j.BABY:j.ADULT:j.BABY:e&&i?n?j.CHILD:d?j.ADULT:j.CHILD:d?j.ADULT:-1)):b.ticketType=j.ADULT}),h.setAttr("passengers",b)},getTicketPolicy:function(a,b){b=b||0;var c=g.getAttr("items"),d=c[b].policy,e=null;switch(a){case-1:e={price:0,fuelCost:0,tax:0};break;case 1:e=d;break;case 2:e=d.childPolicy;break;case 3:e=d.babyPolicy;break;default:e=d}return e},getTicketAmtByType:function(a){var b=g.getAttr("items"),c=this.getTicketPolicy(a),d=0;return c?(d+=c.price+c.fuelCost+c.tax,b.length>1&&(c=this.getTicketPolicy(a,1),c&&(d+=c.price+c.fuelCost+c.tax))):d=null,d},getTicketsCount:function(a,b){var c=a.getAttr("passengers")||[],d=[0,0,0];return _.each(c,function(a){1==a.selected&&a.ticketType&&!a.empty&&d[a.ticketType-1]++}),b?d[d-1]:d},isSupportChild:function(){var a=g.getAttr("items"),b=a[0].policy;return b.isApplyChild||b.childPolicy},isSupportBaby:function(){var a=g.getAttr("items"),b=a[0].policy;return b.isApplyChild||b.childPolicy&&b.childPolicy.isApply||b.babyPolicy},hasChildTicket:function(){var a=g.getAttr("items"),b=a[0].policy;return!!b.childPolicy},hasBabyTicket:function(){var a=g.getAttr("items"),b=a[0].policy;return!!b.babyPolicy},babyCanBuyChildTicket:function(){var a=g.getAttr("items"),b=a[0].policy;return b.childPolicy&&b.childPolicy.isApply},verifyCard:function(a,b,d){var e=/^(19[0-9]{2}|20[01]{1}\d{1})(0[1-9]{1}|1[0-2]{1})(0[1-9]{1}|[12]\d{1}|3[01]{1})$/;if(1==a){if(18==b.length&&c.utility.validate.isIdCard(b)){var f=$.trim(b).substring(6,14);return e.test(f)&&this.getAge(f)>12}return!1}return!b.length||b.length>20?!1:8==a||7==a||10==a?this.isFan(d):!0},verify:function(a){var b=/^[\u4e00-\u9fa5]{2,14}$/,c=/^\w+\/\w+\s*\w+$/i;return!!$.trim(a)&&b.test(a)&&a.length<=29||!!$.trim(a)&&c.test(a)&&a.length<=29},isFan:function(a){for(var b="皚藹礙愛翺襖奧壩罷擺敗頒辦絆幫綁鎊謗剝飽寶報鮑輩貝鋇狽備憊繃筆畢斃閉邊編貶變辯辮鼈癟瀕濱賓擯餅撥缽鉑駁蔔補參蠶殘慚慘燦蒼艙倉滄廁側冊測層詫攙摻蟬饞讒纏鏟産闡顫場嘗長償腸廠暢鈔車徹塵陳襯撐稱懲誠騁癡遲馳恥齒熾沖蟲寵疇躊籌綢醜櫥廚鋤雛礎儲觸處傳瘡闖創錘純綽辭詞賜聰蔥囪從叢湊竄錯達帶貸擔單鄲撣膽憚誕彈當擋黨蕩檔搗島禱導盜燈鄧敵滌遞締點墊電澱釣調叠諜疊釘頂錠訂東動棟凍鬥犢獨讀賭鍍鍛斷緞兌隊對噸頓鈍奪鵝額訛惡餓兒爾餌貳發罰閥琺礬釩煩範販飯訪紡飛廢費紛墳奮憤糞豐楓鋒風瘋馮縫諷鳳膚輻撫輔賦複負訃婦縛該鈣蓋幹趕稈贛岡剛鋼綱崗臯鎬擱鴿閣鉻個給龔宮鞏貢鈎溝構購夠蠱顧剮關觀館慣貫廣規矽歸龜閨軌詭櫃貴劊輥滾鍋國過駭韓漢閡鶴賀橫轟鴻紅後壺護滬戶嘩華畫劃話懷壞歡環還緩換喚瘓煥渙黃謊揮輝毀賄穢會燴彙諱誨繪葷渾夥獲貨禍擊機積饑譏雞績緝極輯級擠幾薊劑濟計記際繼紀夾莢頰賈鉀價駕殲監堅箋間艱緘繭檢堿鹼揀撿簡儉減薦檻鑒踐賤見鍵艦劍餞漸濺澗漿蔣槳獎講醬膠澆驕嬌攪鉸矯僥腳餃繳絞轎較稭階節莖驚經頸靜鏡徑痙競淨糾廄舊駒舉據鋸懼劇鵑絹傑潔結誡屆緊錦僅謹進晉燼盡勁荊覺決訣絕鈞軍駿開凱顆殼課墾懇摳庫褲誇塊儈寬礦曠況虧巋窺饋潰擴闊蠟臘萊來賴藍欄攔籃闌蘭瀾讕攬覽懶纜爛濫撈勞澇樂鐳壘類淚籬離裏鯉禮麗厲勵礫曆瀝隸倆聯蓮連鐮憐漣簾斂臉鏈戀煉練糧涼兩輛諒療遼鐐獵臨鄰鱗凜賃齡鈴淩靈嶺領餾劉龍聾嚨籠壟攏隴樓婁摟簍蘆盧顱廬爐擄鹵虜魯賂祿錄陸驢呂鋁侶屢縷慮濾綠巒攣孿灤亂掄輪倫侖淪綸論蘿羅邏鑼籮騾駱絡媽瑪碼螞馬罵嗎買麥賣邁脈瞞饅蠻滿謾貓錨鉚貿麽黴沒鎂門悶們錳夢謎彌覓綿緬廟滅憫閩鳴銘謬謀畝鈉納難撓腦惱鬧餒膩攆撚釀鳥聶齧鑷鎳檸獰甯擰濘鈕紐膿濃農瘧諾歐鷗毆嘔漚盤龐國愛賠噴鵬騙飄頻貧蘋憑評潑頗撲鋪樸譜臍齊騎豈啓氣棄訖牽扡釺鉛遷簽謙錢鉗潛淺譴塹槍嗆牆薔強搶鍬橋喬僑翹竅竊欽親輕氫傾頃請慶瓊窮趨區軀驅齲顴權勸卻鵲讓饒擾繞熱韌認紉榮絨軟銳閏潤灑薩鰓賽傘喪騷掃澀殺紗篩曬閃陝贍繕傷賞燒紹賒攝懾設紳審嬸腎滲聲繩勝聖師獅濕詩屍時蝕實識駛勢釋飾視試壽獸樞輸書贖屬術樹豎數帥雙誰稅順說碩爍絲飼聳慫頌訟誦擻蘇訴肅雖綏歲孫損筍縮瑣鎖獺撻擡攤貪癱灘壇譚談歎湯燙濤縧騰謄銻題體屜條貼鐵廳聽烴銅統頭圖塗團頹蛻脫鴕馱駝橢窪襪彎灣頑萬網韋違圍爲濰維葦偉僞緯謂衛溫聞紋穩問甕撾蝸渦窩嗚鎢烏誣無蕪吳塢霧務誤錫犧襲習銑戲細蝦轄峽俠狹廈鍁鮮纖鹹賢銜閑顯險現獻縣餡羨憲線廂鑲鄉詳響項蕭銷曉嘯蠍協挾攜脅諧寫瀉謝鋅釁興洶鏽繡虛噓須許緒續軒懸選癬絢學勳詢尋馴訓訊遜壓鴉鴨啞亞訝閹煙鹽嚴顔閻豔厭硯彥諺驗鴦楊揚瘍陽癢養樣瑤搖堯遙窯謠藥爺頁業葉醫銥頤遺儀彜蟻藝億憶義詣議誼譯異繹蔭陰銀飲櫻嬰鷹應纓瑩螢營熒蠅穎喲擁傭癰踴詠湧優憂郵鈾猶遊誘輿魚漁娛與嶼語籲禦獄譽預馭鴛淵轅園員圓緣遠願約躍鑰嶽粵悅閱雲鄖勻隕運蘊醞暈韻雜災載攢暫贊贓髒鑿棗竈責擇則澤賊贈紮劄軋鍘閘詐齋債氈盞斬輾嶄棧戰綻張漲帳賬脹趙蟄轍鍺這貞針偵診鎮陣掙睜猙幀鄭證織職執紙摯擲幟質鍾終種腫衆謅軸皺晝驟豬諸誅燭矚囑貯鑄築駐專磚轉賺樁莊裝妝壯狀錐贅墜綴諄濁茲資漬蹤綜總縱鄒詛組鑽緻鐘麼為隻兇準啟闆裡靂餘鍊洩",c=a.split(""),d=0;d<c.length;d++){var c=a.split("");if(-1!=b.indexOf(c[d]))return!0}return!1},idCardTypeSort:{1:{num:1,name:"身份证"},2:{num:2,name:"护照"},8:{num:3,name:"台胞证"},7:{num:4,name:"回乡证"},4:{num:5,name:"军人证"},10:{num:6,name:"港澳通行证"},25:{num:8,name:"户口簿"},27:{num:9,name:"出生证明"},99:{num:10,name:"其它"}},idCardsDict:function(){return[{type:1,name:"身份证"},{type:2,name:"护照"},{type:8,name:"台胞证"},{type:7,name:"回乡证"},{type:4,name:"军人证"},{type:10,name:"港澳通行证"},{type:25,name:"户口簿"},{type:27,name:"出生证明"},{type:99,name:"其它"}]},childBabyBuyTicketDesc:{title:"儿童婴儿购票说明",lines:["<p>1.航班起飞当日出生未满14天的婴儿，请至航空公司柜台申请购买机票</p>","<p>2.婴儿/儿童年龄区分：婴儿：14天-2周岁；儿童：2-12周岁（按航班起飞当日的实际年龄区分）</p>","<p>3.婴儿票价格：航线标准价的10%，不收机建费及燃油费。（注：婴儿票无座。如需座位，可选择购买儿童票或成人票）</p>","<p>4.儿童票价格：航线标准价的50%，不收机建费，燃油费为成人的50%</p>","<p>5.儿童、婴儿须由成人陪同登机。儿童如单独乘机，需直接至航空公司柜台申请购买机票</p>","<p>6.儿童婴儿购票可用证件：身份证、护照、户口簿、出生证明等</p>","<p>7.儿童婴儿购票可同时购买1份航意险</p>","<p>8. 部分成人价格允许儿童婴儿购买，根据航空公司公布的成人价格政策确定儿童婴儿是否允许购买成人票。</p>"]}},e});