define(["c"],function(a){var b=a.base,c={QueryInvoiceInfoData:function(a,b,c,d,e,f,g){if(null!=a.getAttr("InvoiceTitle"))e.title=a.getAttr("InvoiceTitle"),a.remove();else if(null!=b.getAttr(f)){var h=b.getAttr(f);e.title=h.title}else if(null!=c.getAttr("iinfo")&&c.getAttr("iinfo").title)e.title=c.getAttr("iinfo").title;else{for(var i=d.get()&&d.get().passengers?d.get().passengers:[],j=[],k=0;k<i.length;k++){var l=i[k];if(1==+l.selected){j.push(l);break}}e.title=j.length>0?j[0].language?"EN"==j[0].language?j[0].ename:j[0].cname:1==j[0].defaIdCard.type?j[0].cname:j[0].ename:""}var m=b.getAttr("invoiceinfo",f);return m?(e.inname=m.inname,e.intype=m.intype,e.len=m.len):(m=g.getAttr("invoiceinfo"),e.inname=m[0].inname,e.intype=m[0].intype,e.len=m.len,this.stores.flightOrderInfoInviceStore.setAttr("invoiceinfo",{intype:m[0].intype,inname:m[0].inname,len:m.length},f)),e},reimbursementAction:function(c,d){{var e=this.stores.flightDeliveryStore,f=this.stores.userStore,g=this.stores.flightDetailsStore,h=this.stores.flightOrderStore,i=this.stores.postAddressStorage,j=this.stores.mdStore,k=this.stores.flightSearchStore,l=this.stores.addrListStore,m=this.stores.selAddrStore,n=this.stores.zqInAirportSelectStore,o=this.stores.selFlightInfoStore,p=this.stores.airportDeliveryStore,q=this.stores.invoiceTitleStore,r=this.stores.passengerQueryStore,s=this.stores.flightOrderInfoInviceStore,t=this.parentView.models.addrListModel,u=c.$el.find("#invoice_switch"),v=c.$el.find("#js_address_box"),e=c.stores.flightDeliveryStore,w=e.get(this.UserID)||{type:1},x=e.getAttr("paytype"),y=this.deltabfun,z=this.delzqfun,A=this.delmailfun_1;(function(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,t,v,y,B){if(t.DelItemsData){if(t.DelItemsData.length<=0)return t.showToast("该航班不支持报销凭证配送"),u.find(".cui-switch").removeClass("current"),u.find(".cui-switch-bg").removeClass("current"),void b.addClass("clahead");{c.getAttr("deliveryInfo")}if(d.getStatus())if("16"==u.data("type")||"16"==w.type)b.removeClass("clahead"),c.setAttr("type",16,t.UserID),t.$el.find(".js_del_tab").html(a({type:16,len:t.DelItemsData.length})),t.$el.find(".js_del_box").html(z()),i.setAttr("IsNeedSegment",!0),i.setAttr("IsDeliveryType",!0),t.vVouchers.updateZqAir(t,v,y,B,j,f,m,n,o),t.vVouchers.updateInvoiceBox(q,r,s,e,f,g,t);else if("2"==u.data("type")||"2"==w.type){var C=h.get(t.UserID);b.removeClass("clahead"),c.setAttr("type",2,t.UserID),h.setAttr("edit",1,t.UserID),t.$el.find(".js_del_tab").html(a({type:2,len:t.DelItemsData.length})),t.$el.find(".js_del_box").html(A(C)),this.updateAddrList(h,e,k,c,l,p),t.vVouchers.updateInvoiceBox(q,r,s,e,f,g,t)}else{var C=h.get(t.UserID),D=t.DelItemsData[0];if(b.removeClass("clahead"),c.setAttr("type",D.type,t.UserID),h.setAttr("edit",1,t.UserID),t.$el.find(".js_del_tab").html(this.deltabfun({type:D.type,len:t.DelItemsData.length})),t.$el.find(".js_del_box").html(A(C)),32==D.type){if($(".js_del_cost .flight-listsim3").show(),$("#gift-card-tips").show(),D.exinfo){c.setAttr("type",D.type,t.UserID),c.setAttr("deliveryInfo",{type:D.type,sendFee:D.exinfo.fee,fee:D.exinfo.fee},t.UserID);var E=_.filter(D.exinfo.pays,function(a){return a.paytype==x}).length;E||(x=t.getPayType(D.exinfo.pays),c.setAttr("paytype",x,t.UserID)),this.parentView.trigger(this.parentView.EVENTS.UPDATEORDERPRICE),c.setAttr("pays",D.exinfo.pays,t.UserID),w=c.get(t.UserID),w.islogin=e.isLogin(),w.fee=D.exinfo.fee,w.isLogin=e.isLogin(),t.$el.find(".js_del_cost").html(this.delcostfun(w))}}else $(".js_del_cost .flight-listsim3").hide(),$("#gift-card-tips").hide();this.updateAddrList(h,e,k,c,l,p),t.vVouchers.updateInvoiceBox(q,r,s,e,f,g,t)}else b.addClass("clahead"),$("#gift-card-tips").hide(),c.setAttr("type",1,t.UserID),h.setAttr("edit",0,t.UserID),this.parentView.trigger(this.parentView.EVENTS.UPDATEORDERPRICE),t.$el.find('.error-tips[data-role="delivery"]').hide();v.ui.InputClear(t.$el.find('.flight-listsim3-table input[type="text"],.flight-listsim3-table input[type="tel"]'),null,null,{top:20,right:-25},!0),$("#js_invoice_title").next(".cui-focus-close").detach(),i.setAttr("IsNeedSegment",!0),i.setAttr("IsDeliveryType",!0)}}).call(this,y,v,e,f,g,h,i,j,k,l,m,n,o,p,t,c,a,b,this.Calendar)}},updateZqAir:function(a,b,c,d,e,f,g,h,i){if(a.zqTimeObj=a.zqTimeObj||{},a.DelItemsData&&a.DelItemsData.length>0){for(var j=null,k=0;k<a.DelItemsData.length;k++)16===a.DelItemsData[k].type&&(j=a.DelItemsData[k].addrs);{var l=e.getSearchDetails(0,"dCtyCode"),m=e.getSearchDetails(0,"aCtyCode"),n=f.get(),o=g.get()?g.get().index:1,p=0;h.get()}if(a.citykey=l+m,!j)return;if(_.each(j,function(a,b){a.index==o&&(p=b)}),j&&j[p]){var q=$.trim(j[p].btime),r=$.trim(j[p].etime);a.zqTimeObj.dutyBtime=b.base.Date.parse(a.getServerDate().setHours(q.slice(0,2),q.slice(2),0,0)),a.zqTimeObj.dutyEtime=b.base.Date.parse(a.getServerDate().setHours(r.slice(0,2),r.slice(2),0,0)),a.zqTimeObj.serverDate=b.base.Date.parse(a.getServerDate().toString()).addHours(2).valueOf(),a.zqTimeObj.airDate=b.base.Date.parse(n.items[0].basicInfo.dTime).addHours(-2).valueOf(),a.zqTimeObj.validDate=this.zqParseDate(c,a.zqTimeObj.serverDate,a.zqTimeObj.airDate,a.zqTimeObj.dutyBtime,a.zqTimeObj.dutyEtime),a.zqTimeObj.defaDate=a.zqTimeObj.validDate.length>0&&a.zqTimeObj.validDate[a.zqTimeObj.validDate.length-1][1];var s="00",t="00";if(i.getAttr("time")?(a.zqTimeObj.selectDate=b.base.Date.parse(i.getAttr("time")).valueOf(),s=a.zqTimeObj.selectDate.getMinutes().toString(),t=a.zqTimeObj.selectDate.getHours().toString()):a.zqTimeObj.selectDate=a.zqTimeObj.defaDate,a.zqTimeObj.defaHourList=a.zqPrintDetail(a.zqTimeObj.validDate,a.zqTimeObj.selectDate),a.zqTimeObj.defaHourList&&a.zqTimeObj.defaHourList.length>0){var u=(t.length<2?"0"+t:t)+":"+(s.length<2?"0"+s:s);(!i.getAttr("time")||a.zqTimeObj.defaHourList.indexOf(u)<0)&&(a.zqTimeObj.defaHour=a.zqTimeObj.defaHourList[a.zqTimeObj.defaHourList.length-1],a.zqTimeObj.selectDate.setHours(a.zqTimeObj.defaHour.slice(0,2),a.zqTimeObj.defaHour.slice(3)))}var v=(n&&n.insurances&&n.insurances.length>0&&n.insurances[0]&&n.insurances[0].sites&&n.insurances[0].sites.indexOf(j[p].site)>=0,i.get(a.citykey)||{});for(var w in j[p])v[w]=j[p][w];v.time=a.zqTimeObj.selectDate.toString(),i.set(v,a.citykey),v.cDate=b.base.Date,a.$el.find(".js_del_box").html(this.delzqfun(v))}a.showCalendarUI(i,d,a)}},updateAddrList:function(a,b,c,d,e,f){b.isLogin()?f.excute(function(){c.setAttr("UserId",this.UserID,c.getTag()),this.renderDelBox(a,b,c,d,e)},function(){this.renderDelBox(a,b,c,d,e)},!0,this):this.renderDelBox(a,b,c,d,e)},renderDelBox:function(a,b,c,d,e,f){var g=this,h=this.delmailfun_2,i=a.get(this.parentView.uid);i.clazz=0==i.inforId?"m_colorb":"";var j=c.get();if(!b.isLogin()&&j&&j.UserId&&(c.remove(),j=c.get()),j&&j.addrs&&j.addrs.length>0){var k=j.addrs.some(function(a){return a.inforId==i.inforId||0==i.inforId});if(!k){i.prvnName="",i.ctyName="",i.dstrName="",i.addr="",i.recipient="",i.zip="",a.remove();var l=d.get(),m=d.getAttr("deliveryInfo");1==l.rc&&(l.rc=0,l.paytype=f.getPayType(),d.setAttr("paytype",l.paytype),l.fee=m.sendFee,f.$el.find(".js_del_cost").html(f.delcostfun(l)),g.parentView.trigger(g.parentView.EVENTS.UPDATEORDERPRICE))}this.$el.find(".js_del_box").html(h(i))}else{var n=e.get(this.parentView.uid);n.prvnName&&n.ctyName&&n.dstrName&&(i.prvnId=n.prvnId,i.prvnName=n.prvnName,i.ctyId=n.ctyId,i.ctyName=n.ctyName,i.dstrId=n.dstrId,i.dstrName=n.dstrName),a.set(i,this.parentView.uid),this.$el.find(".js_del_box").html(h(i))}},onInputLogAddr:function(a,b,c){var d=a.isLogin()?c.UserID:"";this.$el.find(".js_recipient").on("input",function(){var a=$.trim($(this).val());b.setAttr("recipient",a,d)}),this.$el.find(".js_addr").on("input",function(){var a=$.trim($(this).val());b.setAttr("addr",a,d)}),this.$el.find(".js_zip").on("input",function(){var a=$.trim($(this).val());b.setAttr("zip",a,d)})},zqParseDate:function(a,b,c,d,e){var f=b.getTime(),g=c.getTime(),h=d.getHours(),i=e.getHours(),j=d.getMinutes(),k=d.getMinutes(),l=b.getMonth()+1,m=c.getMonth()+1,n=b.getDate(),o=c.getDate(),p=b.getFullYear(),q=c.getFullYear(),r=[],s=new a.Date.parse(p+"-"+l+"-"+n+" "+h+":"+j),t=new a.Date.parse(p+"-"+l+"-"+n+" "+i+":"+k),u=s.getTime(),v=t.getTime();if(l==m&&n==o&&p==q){if(u>f&&g>v)return r.push([new Date(s),new Date(t)]),r;if(f>u&&v>f&&g>v)return r.push([b,t]),r;if(f>u&&v>f&&v>g)return r.push([b,c]),r;if(u>f&&v>g&&g>u)return r.push([d,c]),r;if(f>v&&g>v||u>f&&u>f||u>f&&u>g)return r}else{for(var w=new a.Date.parse(q+"-"+m+"-"+o+" 0:00").date.getTime()-new a.Date.parse(p+"-"+l+"-"+n+" 0:00").date.getTime(),x=Math.floor(w/864e5)+1,y=0,z=[];x>y;y++){var A=s.getTime()+864e5*y,B=t.getTime()+864e5*y;z.push([new Date(A),new Date(B)])}var C=z[0][0].getTime(),D=z[0][1].getTime(),E=z[z.length-1][0].getTime(),F=z[z.length-1][1].getTime();if(r=z.slice(),2==x){if(f>D&&E>g)return[];if(f>C&&E>g)return r.splice(r.length-1,1),r[0][0]=b,r;if(f>D)return r.splice(0,1),r[0][1]=c,r}if(f>D&&g>E&&F>g)return r.splice(0,1),r[r.length-1][1]=c,r;if(f>C&&D>f&&E>g)return r.splice(r.length-1,1),r[0][0]=b,r;if(f>D)return r.splice(0,1),r;if(E>g)return r.splice(r.length-1,1),r;if(C>f&&F>g)return r[r.length-1][1]=c,r;if(f>C&&g>F)return r[0][0]=b,r;if(f>C&&F>g)return r[0][0]=b,r[r.length-1][1]=c,r;if(C>f&&g>F)return r}}};return c});